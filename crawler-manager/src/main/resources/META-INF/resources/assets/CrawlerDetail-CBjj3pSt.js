import{u as ee,s as te,a as se,b as A,A as y,H as le,_ as ae}from"./index-Dae46fKR.js";import{j as f}from"./primevue-b03PsPUA.js";import{G as ie,r as h,C as x,o as oe,K as re,h as r,i as e,e as c,z as u,H as n,t as a,s as $,q as ne,j as b,d as M,f as o}from"./vendor-CQjc8Gll.js";const de={class:"crawler-detail"},ce={class:"surface-0 shadow-2 p-3 border-1 border-50 border-round"},ue={class:"flex align-items-center mb-5"},ve={class:"flex-1"},me={class:"flex align-items-center"},fe={class:"text-900 text-3xl font-medium mr-3"},pe={class:"text-600 text-xl"},he={class:"flex align-items-center"},xe={key:0,class:"flex align-items-center justify-content-center p-6"},_e={key:1,class:"card"},ge={class:"flex align-items-center"},we={class:"text-sm"},ye={class:"text-center mt-3"},be={key:2,class:"grid"},Ce={class:"col-12 lg:col-6"},ke={class:"card h-full"},Ee={key:0,class:"grid"},He={class:"col-6"},Se={class:"text-900 font-medium"},Te={class:"col-6"},Le={class:"text-900 font-medium"},De={class:"col-6"},Ue={class:"text-900 font-medium"},Ae={class:"col-6"},Ie={class:"text-900 font-medium"},Re={class:"col-6"},Fe={class:"text-900 font-medium"},Ne={class:"col-6"},$e={class:"flex align-items-center"},Me={class:"col-12 lg:col-6"},Ve={class:"card h-full"},Ye={key:0,class:"grid"},Be={class:"col-6"},Oe={class:"flex align-items-center"},qe={class:"col-6"},Pe={class:"text-900 font-medium"},je={class:"col-12"},ze={class:"text-900 font-medium"},We={key:0,class:"col-12"},Ge={class:"text-900 font-medium"},Je={class:"col-12"},Ke={class:"card"},Qe={key:0,class:"grid"},Xe={class:"col-12 md:col-4"},Ze={class:"flex align-items-center p-2 surface-100 border-round"},et={class:"text-900 text-sm flex-1"},tt={class:"col-12 md:col-4"},st={class:"flex align-items-center p-2 surface-100 border-round"},lt={class:"text-900 text-sm flex-1"},at={class:"col-12 md:col-4"},it={class:"flex align-items-center p-2 surface-100 border-round"},ot={class:"text-900 text-sm flex-1"},rt={key:0,class:"col-12"},nt={class:"card"},dt={class:"grid"},ct={class:"col-12 md:col-6"},ut={class:"flex align-items-center"},vt={class:"col-12 md:col-6"},mt={class:"text-900 font-medium"},ft={key:0,class:"col-12 md:col-6"},pt={class:"text-900 font-medium"},ht={class:"col-12 md:col-6"},xt={class:"text-900 font-medium"},_t={key:1,class:"col-12"},gt={class:"text-900 font-medium"},wt={key:2,class:"col-12"},yt={class:"text-900 font-medium"},bt={key:3,class:"col-12"},Ct={class:"text-900 font-medium"},kt={class:"col-12"},Et={class:"card"},Ht={class:"flex flex-wrap gap-2"},St={class:"flex align-items-center"},Tt={key:0,class:"text-600 ml-2"},Lt={key:3,class:"text-center mt-4"},Dt={class:"text-600"},Ut=ie({__name:"CrawlerDetail",props:{id:{}},setup(V){const p=V,v=ee(),H=h(!0),C=h(!1),S=h(!1),k=h(null),l=h(null),i=h(null),_=h(null),d=h(null);let E=null,T=null;const Y=x(()=>p.id),L=x(()=>{var s;return((s=l.value)==null?void 0:s.name)||p.id}),B=x(()=>{if(!i.value)return"health-unknown";switch(i.value.status){case"HEALTHY":return"health-healthy";case"UNHEALTHY":return"health-unhealthy";default:return"health-unknown"}}),O=x(()=>{if(!i.value)return"pi pi-question-circle";switch(i.value.status){case"HEALTHY":return"pi pi-check-circle";case"UNHEALTHY":return"pi pi-times-circle";default:return"pi pi-question-circle"}}),q=x(()=>{if(!i.value)return"warning";switch(i.value.status){case"HEALTHY":return"success";case"UNHEALTHY":return"danger";default:return"warning"}}),P=x(()=>!i.value||i.value.responseTimeMs===null?"N/A":`${i.value.responseTimeMs}ms`),j=x(()=>{if(!i.value||!i.value.lastCheck)return"Never";const s=new Date(i.value.lastCheck),m=new Date().getTime()-s.getTime(),g=Math.floor(m/1e3),w=Math.floor(g/60);return g<60?`${g}s ago`:w<60?`${w}m ago`:s.toLocaleString()}),z=x(()=>{if(!_.value)return"Never";const t=new Date().getTime()-_.value.getTime(),m=Math.floor(t/1e3);return m<60?`${m}s ago`:m<3600?`${Math.floor(m/60)}m ago`:_.value.toLocaleString()}),I=async()=>{try{k.value=null,H.value=!0;const[s,t]=await Promise.all([y.getCrawlerConfigurations(),y.getCrawlerHealth(p.id)]);if(l.value=s.find(m=>m.id===p.id)||null,i.value=t,!l.value)throw new Error(`Crawler with ID '${p.id}' not found`);_.value=new Date}catch(s){console.error("Failed to load crawler details:",s),k.value=s instanceof Error?s.message:"Unknown error occurred",v.add({severity:"error",summary:"Load Error",detail:"Failed to load crawler details",life:5e3})}finally{H.value=!1}},R=async()=>{C.value=!0;try{const s=await y.forceHealthCheck(p.id);i.value=s,_.value=new Date,v.add({severity:"success",summary:"Health Check",detail:`Forced health check for ${L.value}`,life:3e3})}catch(s){console.error("Failed to force health check:",s),v.add({severity:"error",summary:"Error",detail:"Failed to perform health check",life:5e3})}finally{C.value=!1}},D=async s=>{try{await navigator.clipboard.writeText(s),v.add({severity:"success",summary:"Copied",detail:"URL copied to clipboard",life:2e3})}catch(t){console.error("Failed to copy to clipboard:",t),v.add({severity:"error",summary:"Error",detail:"Failed to copy URL",life:3e3})}},W=()=>{if(l.value){const s=l.value.baseUrl+l.value.healthEndpoint;window.open(s,"_blank")}},G=async()=>{if(l.value){S.value=!0;try{const s=await y.triggerCrawl(p.id);switch(d.value=s,s.status){case"ACCEPTED":v.add({severity:"success",summary:"Crawl Started",detail:`Crawl initiated successfully for ${L.value}`,life:5e3});break;case"CONFLICT":v.add({severity:"warn",summary:"Crawl Already Running",detail:s.message,life:5e3});break;case"SERVICE_UNAVAILABLE":v.add({severity:"error",summary:"Service Unavailable",detail:s.message,life:5e3});break;case"ERROR":v.add({severity:"error",summary:"Crawl Failed",detail:s.message,life:5e3});break}}catch(s){console.error("Failed to trigger crawl:",s),v.add({severity:"error",summary:"Error",detail:s instanceof Error?s.message:"Failed to trigger crawl",life:5e3})}finally{S.value=!1}}},J=s=>{switch(s){case"ACCEPTED":return"success";case"CONFLICT":return"warning";case"SERVICE_UNAVAILABLE":case"ERROR":return"danger";default:return"info"}},K=s=>{try{return new Date(s).toLocaleString()}catch{return s}},Q=async()=>{try{const s=await y.getCrawlerStatus(p.id);v.add({severity:"info",summary:"Crawl Status",detail:`Current status: ${JSON.stringify(s,null,2)}`,life:8e3})}catch(s){console.error("Failed to check crawl status:",s),v.add({severity:"error",summary:"Error",detail:s instanceof Error?s.message:"Failed to check crawl status",life:5e3})}},X=s=>{s.crawlerId===p.id&&(i.value={status:s.status,message:s.message,lastCheck:s.timestamp,responseTimeMs:null,crawlerId:s.crawlerId},_.value=new Date)},Z=()=>{try{E=new le,T=E.onHealthUpdate(X)}catch(s){console.error("Failed to initialize WebSocket:",s)}};return oe(async()=>{await I(),Z()}),re(()=>{T&&T(),E&&E.disconnect()}),(s,t)=>{var m,g,w,F,N;return o(),r("div",de,[e("div",ce,[e("div",ue,[u(n(f),{icon:"pi pi-arrow-left",class:"p-button-text p-button-plain mr-3",onClick:t[0]||(t[0]=U=>s.$router.push("/"))}),e("div",ve,[e("div",me,[e("div",fe,a(L.value),1),i.value?(o(),r("div",{key:0,class:$(["health-indicator",B.value])},[e("i",{class:$(O.value)},null,2)],2)):c("",!0)]),e("span",pe,a(Y.value),1)]),e("div",he,[u(n(f),{icon:"pi pi-refresh",label:"Refresh",class:"p-button-sm",loading:C.value,onClick:R},null,8,["loading"])])]),H.value?(o(),r("div",xe,[u(n(te)),t[4]||(t[4]=e("span",{class:"ml-3 text-600"},"Loading crawler details...",-1))])):k.value?(o(),r("div",_e,[u(n(se),{severity:"error",closable:!1},{default:ne(()=>[e("div",ge,[t[6]||(t[6]=e("i",{class:"pi pi-exclamation-triangle mr-2"},null,-1)),e("div",null,[t[5]||(t[5]=e("div",{class:"font-medium"},"Failed to load crawler details",-1)),e("div",we,a(k.value),1)])])]),_:1}),e("div",ye,[u(n(f),{icon:"pi pi-refresh",label:"Retry",onClick:I})])])):(o(),r("div",be,[e("div",Ce,[e("div",ke,[t[13]||(t[13]=e("h5",{class:"flex align-items-center"},[e("i",{class:"pi pi-cog mr-2"}),b(" Configuration ")],-1)),l.value?(o(),r("div",Ee,[e("div",He,[t[7]||(t[7]=e("div",{class:"text-600 text-sm mb-1"},"Name",-1)),e("div",Se,a(l.value.name),1)]),e("div",Te,[t[8]||(t[8]=e("div",{class:"text-600 text-sm mb-1"},"ID",-1)),e("div",Le,a(l.value.id),1)]),e("div",De,[t[9]||(t[9]=e("div",{class:"text-600 text-sm mb-1"},"Base URL",-1)),e("div",Ue,a(l.value.baseUrl),1)]),e("div",Ae,[t[10]||(t[10]=e("div",{class:"text-600 text-sm mb-1"},"Port",-1)),e("div",Ie,a(l.value.port),1)]),e("div",Re,[t[11]||(t[11]=e("div",{class:"text-600 text-sm mb-1"},"Health Endpoint",-1)),e("div",Fe,a(l.value.healthEndpoint),1)]),e("div",Ne,[t[12]||(t[12]=e("div",{class:"text-600 text-sm mb-1"},"Status",-1)),e("div",$e,[u(n(A),{value:l.value.enabled?"Enabled":"Disabled",severity:l.value.enabled?"success":"danger",class:"text-xs"},null,8,["value","severity"])])])])):c("",!0)])]),e("div",Me,[e("div",Ve,[t[18]||(t[18]=e("h5",{class:"flex align-items-center"},[e("i",{class:"pi pi-heart mr-2"}),b(" Health Status ")],-1)),i.value?(o(),r("div",Ye,[e("div",Be,[t[14]||(t[14]=e("div",{class:"text-600 text-sm mb-1"},"Current Status",-1)),e("div",Oe,[u(n(A),{value:i.value.status,severity:q.value,class:"text-xs"},null,8,["value","severity"])])]),e("div",qe,[t[15]||(t[15]=e("div",{class:"text-600 text-sm mb-1"},"Response Time",-1)),e("div",Pe,a(P.value),1)]),e("div",je,[t[16]||(t[16]=e("div",{class:"text-600 text-sm mb-1"},"Last Check",-1)),e("div",ze,a(j.value),1)]),i.value.message?(o(),r("div",We,[t[17]||(t[17]=e("div",{class:"text-600 text-sm mb-1"},"Message",-1)),e("div",Ge,a(i.value.message),1)])):c("",!0)])):c("",!0)])]),e("div",Je,[e("div",Ke,[t[22]||(t[22]=e("h5",{class:"flex align-items-center"},[e("i",{class:"pi pi-link mr-2"}),b(" Endpoints ")],-1)),l.value?(o(),r("div",Qe,[e("div",Xe,[t[19]||(t[19]=e("div",{class:"text-600 text-sm mb-2"},"Health Check",-1)),e("div",Ze,[e("span",et,a(l.value.baseUrl)+a(l.value.healthEndpoint),1),u(n(f),{icon:"pi pi-copy",class:"p-button-text p-button-sm",onClick:t[1]||(t[1]=U=>D(l.value.baseUrl+l.value.healthEndpoint))})])]),e("div",tt,[t[20]||(t[20]=e("div",{class:"text-600 text-sm mb-2"},"Crawl Endpoint",-1)),e("div",st,[e("span",lt,a(l.value.baseUrl)+a(l.value.crawlEndpoint),1),u(n(f),{icon:"pi pi-copy",class:"p-button-text p-button-sm",onClick:t[2]||(t[2]=U=>D(l.value.baseUrl+l.value.crawlEndpoint))})])]),e("div",at,[t[21]||(t[21]=e("div",{class:"text-600 text-sm mb-2"},"Status Endpoint",-1)),e("div",it,[e("span",ot,a(l.value.baseUrl)+a(l.value.statusEndpoint),1),u(n(f),{icon:"pi pi-copy",class:"p-button-text p-button-sm",onClick:t[3]||(t[3]=U=>D(l.value.baseUrl+l.value.statusEndpoint))})])])])):c("",!0)])]),d.value?(o(),r("div",rt,[e("div",nt,[t[30]||(t[30]=e("h5",{class:"flex align-items-center"},[e("i",{class:"pi pi-history mr-2"}),b(" Last Crawl Response ")],-1)),e("div",dt,[e("div",ct,[t[23]||(t[23]=e("div",{class:"text-600 text-sm mb-1"},"Status",-1)),e("div",ut,[u(n(A),{value:d.value.status,severity:J(d.value.status),class:"text-xs"},null,8,["value","severity"])])]),e("div",vt,[t[24]||(t[24]=e("div",{class:"text-600 text-sm mb-1"},"Request ID",-1)),e("div",mt,a(d.value.requestId),1)]),d.value.crawlId?(o(),r("div",ft,[t[25]||(t[25]=e("div",{class:"text-600 text-sm mb-1"},"Crawl ID",-1)),e("div",pt,a(d.value.crawlId),1)])):c("",!0),e("div",ht,[t[26]||(t[26]=e("div",{class:"text-600 text-sm mb-1"},"Timestamp",-1)),e("div",xt,a(K(d.value.timestamp)),1)]),d.value.message?(o(),r("div",_t,[t[27]||(t[27]=e("div",{class:"text-600 text-sm mb-1"},"Message",-1)),e("div",gt,a(d.value.message),1)])):c("",!0),d.value.suggestion?(o(),r("div",wt,[t[28]||(t[28]=e("div",{class:"text-600 text-sm mb-1"},"Suggestion",-1)),e("div",yt,a(d.value.suggestion),1)])):c("",!0),d.value.estimatedDuration?(o(),r("div",bt,[t[29]||(t[29]=e("div",{class:"text-600 text-sm mb-1"},"Estimated Duration",-1)),e("div",Ct,a(d.value.estimatedDuration),1)])):c("",!0)])])])):c("",!0),e("div",kt,[e("div",Et,[t[31]||(t[31]=e("h5",{class:"flex align-items-center"},[e("i",{class:"pi pi-wrench mr-2"}),b(" Actions ")],-1)),e("div",Ht,[e("div",St,[u(n(f),{icon:"pi pi-play",label:"Start Crawl",loading:S.value,disabled:!((m=l.value)!=null&&m.enabled)||((g=i.value)==null?void 0:g.status)!=="HEALTHY",onClick:G,class:"p-button-success"},null,8,["loading","disabled"]),!((w=l.value)!=null&&w.enabled)||((F=i.value)==null?void 0:F.status)!=="HEALTHY"?(o(),r("small",Tt,a((N=l.value)!=null&&N.enabled?"Crawler must be healthy to start crawl":"Crawler is disabled"),1)):c("",!0)]),u(n(f),{icon:"pi pi-refresh",label:"Force Health Check",loading:C.value,onClick:R},null,8,["loading"]),l.value?(o(),M(n(f),{key:0,icon:"pi pi-info-circle",label:"Check Crawl Status",class:"p-button-outlined",onClick:Q})):c("",!0),l.value?(o(),M(n(f),{key:1,icon:"pi pi-external-link",label:"Open Health Endpoint",class:"p-button-outlined",onClick:W})):c("",!0)])])])])),_.value?(o(),r("div",Lt,[e("small",Dt," Last updated: "+a(z.value),1)])):c("",!0)])])}}}),Ft=ae(Ut,[["__scopeId","data-v-29d927b3"]]);export{Ft as default};
