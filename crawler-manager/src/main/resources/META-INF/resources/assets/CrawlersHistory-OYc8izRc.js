import{d as q,a as X,_ as z}from"./index-CLecQaJA.js";import{g as E,A as _,D as K}from"./primevue-DG7TyHL6.js";import{s as N}from"./index-0Z71WcPi.js";import{s as Q}from"./index-DIdlnjo6.js";import{a as Y,J as Z}from"./JobHistory-3jw-gaMT.js";import{M as ee,r as j,B as D,o as te,h as re,i,v as m,N as b,s as B,f as ae}from"./vendor-4T9WLNsm.js";import"./index-BgkhjCKx.js";var ne=typeof global=="object"&&global&&global.Object===Object&&global,oe=typeof self=="object"&&self&&self.Object===Object&&self,W=ne||oe||Function("return this")(),F=W.Symbol,G=Object.prototype,le=G.hasOwnProperty,se=G.toString,x=F?F.toStringTag:void 0;function ie(e){var o=le.call(e,x),s=e[x];try{e[x]=void 0;var c=!0}catch{}var u=se.call(e);return c&&(o?e[x]=s:delete e[x]),u}var de=Object.prototype,ce=de.toString;function ue(e){return ce.call(e)}var fe="[object Null]",me="[object Undefined]",P=F?F.toStringTag:void 0;function pe(e){return e==null?e===void 0?me:fe:P&&P in Object(e)?ie(e):ue(e)}function ye(e){return e!=null&&typeof e=="object"}var ve="[object Symbol]";function be(e){return typeof e=="symbol"||ye(e)&&pe(e)==ve}var ge=/\s/;function he(e){for(var o=e.length;o--&&ge.test(e.charAt(o)););return o}var we=/^\s+/;function Ce(e){return e&&e.slice(0,he(e)+1).replace(we,"")}function L(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var U=NaN,Se=/^[-+]0x[0-9a-f]+$/i,Te=/^0b[01]+$/i,je=/^0o[0-7]+$/i,xe=parseInt;function H(e){if(typeof e=="number")return e;if(be(e))return U;if(L(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=L(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=Ce(e);var s=Te.test(e);return s||je.test(e)?xe(e.slice(2),s?2:8):Se.test(e)?U:+e}var k=function(){return W.Date.now()},Ie="Expected a function",Oe=Math.max,Re=Math.min;function Ve(e,o,s){var c,u,p,y,a,f,h=0,I=!1,w=!1,S=!0;if(typeof e!="function")throw new TypeError(Ie);o=H(o)||0,L(s)&&(I=!!s.leading,w="maxWait"in s,p=w?Oe(H(s.maxWait)||0,o):p,S="trailing"in s?!!s.trailing:S);function C(l){var r=c,t=u;return c=u=void 0,h=l,y=e.apply(t,r),y}function J(l){return h=l,a=setTimeout(g,o),I?C(l):y}function M(l){var r=l-f,t=l-h,n=o-r;return w?Re(n,p-t):n}function O(l){var r=l-f,t=l-h;return f===void 0||r>=o||r<0||w&&t>=p}function g(){var l=k();if(O(l))return R(l);a=setTimeout(g,M(l))}function R(l){return a=void 0,S&&c?C(l):(c=u=void 0,y)}function $(){a!==void 0&&clearTimeout(a),h=0,c=f=u=a=void 0}function V(){return a===void 0?y:R(k())}function T(){var l=k(),r=O(l);if(c=arguments,u=this,f=l,r){if(a===void 0)return J(f);if(w)return clearTimeout(a),a=setTimeout(g,o),C(f)}return a===void 0&&(a=setTimeout(g,o)),y}return T.cancel=$,T.flush=V,T}const Ae={class:"crawlers-history"},De={class:"page-header"},Fe={class:"header-actions"},Je={class:"filters-grid"},Me={class:"field"},$e={class:"field"},ke={class:"field"},Le={class:"field"},Ee=ee({__name:"CrawlersHistory",setup(e){const o=q(),s=X(),c=j(!1),u=j(!1),p=j(!1),y=j(null),a=j({crawlerId:null,status:null,dateRange:null,search:""}),f=j([]),h=D(()=>o.crawlers),I=D(()=>[...h.value.map(r=>({id:r.id,name:r.name}))]),w=D(()=>[{label:"Completed",value:"completed"},{label:"Running",value:"running"},{label:"Failed",value:"failed"},{label:"Cancelled",value:"cancelled"},{label:"Pending",value:"pending"}]),S=D(()=>{let r=[...f.value];if(a.value.crawlerId&&(r=r.filter(t=>t.crawlerId===a.value.crawlerId)),a.value.status&&(r=r.filter(t=>t.status===a.value.status)),a.value.dateRange&&a.value.dateRange.length===2){const[t,n]=a.value.dateRange;r=r.filter(d=>{const v=new Date(d.startedAt);return v>=t&&v<=n})}if(a.value.search){const t=a.value.search.toLowerCase();r=r.filter(n=>{var d,v;return n.id.toLowerCase().includes(t)||((d=n.crawlerName)==null?void 0:d.toLowerCase().includes(t))||((v=n.url)==null?void 0:v.toLowerCase().includes(t))})}return r}),C=async()=>{u.value=!0;try{await l(),s.add({severity:"success",summary:"Success",detail:"Job history refreshed successfully",life:3e3})}catch{s.add({severity:"error",summary:"Error",detail:"Failed to refresh job history",life:5e3})}finally{u.value=!1}},J=async()=>{try{const r=S.value.map(n=>({id:n.id,crawler:n.crawlerName,status:n.status,startedAt:n.startedAt,completedAt:n.completedAt,duration:n.duration,articlesFound:n.articlesFound,url:n.url})),t=M(r);O(t,"crawler-history.csv"),s.add({severity:"success",summary:"Export Complete",detail:"Job history exported successfully",life:3e3})}catch{s.add({severity:"error",summary:"Export Failed",detail:"Failed to export job history",life:5e3})}},M=r=>{if(r.length===0)return"";const t=Object.keys(r[0]);return[t.join(","),...r.map(d=>t.map(v=>{const A=d[v];return typeof A=="string"&&A.includes(",")?`"${A}"`:A}).join(","))].join(`
`)},O=(r,t)=>{const n=new Blob([r],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),v=URL.createObjectURL(n);d.setAttribute("href",v),d.setAttribute("download",t),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},g=()=>{},R=Ve(()=>{},300),$=r=>{y.value=r,p.value=!0},V=async r=>{try{await new Promise(t=>setTimeout(t,1e3)),s.add({severity:"success",summary:"Job Retried",detail:`Job ${r} has been queued for retry`,life:3e3}),await C()}catch{s.add({severity:"error",summary:"Retry Failed",detail:`Failed to retry job ${r}`,life:5e3})}},T=async r=>{try{await new Promise(t=>setTimeout(t,500)),s.add({severity:"success",summary:"Job Cancelled",detail:`Job ${r} has been cancelled`,life:3e3}),await C()}catch{s.add({severity:"error",summary:"Cancel Failed",detail:`Failed to cancel job ${r}`,life:5e3})}},l=async()=>{f.value=Array.from({length:20},(r,t)=>({id:`job-${t+1}`,crawlerId:t%2===0?"drucker":"caspit",crawlerName:t%2===0?"Drucker Crawler":"Caspit Crawler",status:["completed","running","failed","cancelled"][Math.floor(Math.random()*4)],startedAt:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),completedAt:Math.random()>.3?new Date(Date.now()-Math.random()*6*24*60*60*1e3).toISOString():null,duration:Math.floor(Math.random()*120)+30,articlesFound:Math.floor(Math.random()*50)+5,url:`https://example.com/article-${t+1}`}))};return te(async()=>{c.value=!0;try{await Promise.all([o.loadCrawlerData(),l()])}catch{s.add({severity:"error",summary:"Load Failed",detail:"Failed to load history data",life:5e3})}finally{c.value=!1}}),(r,t)=>(ae(),re("div",Ae,[i("div",De,[t[5]||(t[5]=i("div",{class:"header-content"},[i("h1",{class:"page-title"},"Crawlers History"),i("p",{class:"page-description"},"View crawler job history and details")],-1)),i("div",Fe,[m(b(E),{icon:"pi pi-refresh",label:"Refresh",onClick:C,loading:u.value,severity:"secondary"},null,8,["loading"]),m(b(E),{icon:"pi pi-download",label:"Export",onClick:J,severity:"primary"})])]),m(b(_),{class:"filters-card"},{content:B(()=>[i("div",Je,[i("div",Me,[t[6]||(t[6]=i("label",{for:"crawler-filter"},"Crawler",-1)),m(b(N),{id:"crawler-filter",modelValue:a.value.crawlerId,"onUpdate:modelValue":t[0]||(t[0]=n=>a.value.crawlerId=n),options:I.value,optionLabel:"name",optionValue:"id",placeholder:"All Crawlers",showClear:"",onChange:g},null,8,["modelValue","options"])]),i("div",$e,[t[7]||(t[7]=i("label",{for:"status-filter"},"Status",-1)),m(b(N),{id:"status-filter",modelValue:a.value.status,"onUpdate:modelValue":t[1]||(t[1]=n=>a.value.status=n),options:w.value,optionLabel:"label",optionValue:"value",placeholder:"All Statuses",showClear:"",onChange:g},null,8,["modelValue","options"])]),i("div",ke,[t[8]||(t[8]=i("label",{for:"date-range"},"Date Range",-1)),m(b(Q),{id:"date-range",modelValue:a.value.dateRange,"onUpdate:modelValue":t[2]||(t[2]=n=>a.value.dateRange=n),selectionMode:"range",dateFormat:"yy-mm-dd",showButtonBar:"",onDateSelect:g},null,8,["modelValue"])]),i("div",Le,[t[9]||(t[9]=i("label",{for:"search"},"Search",-1)),m(b(K),{id:"search",modelValue:a.value.search,"onUpdate:modelValue":t[3]||(t[3]=n=>a.value.search=n),placeholder:"Search jobs...",onInput:b(R)},null,8,["modelValue","onInput"])])])]),_:1}),m(b(_),{class:"history-table-card"},{content:B(()=>[m(Z,{jobs:S.value,loading:c.value,crawlerId:"all",onViewDetails:$,onRetryJob:V,onCancelJob:T},null,8,["jobs","loading"])]),_:1}),m(Y,{visible:p.value,"onUpdate:visible":t[4]||(t[4]=n=>p.value=n),job:y.value||{id:"",status:"pending",startedAt:"",crawlerId:""},onRetry:V,onCancel:T},null,8,["visible","job"])]))}}),Ge=z(Ee,[["__scopeId","data-v-a577c49e"]]);export{Ge as default};
