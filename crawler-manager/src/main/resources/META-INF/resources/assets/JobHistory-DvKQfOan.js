import{_ as Q,A as R,e as ye}from"./index-DZVWbUD3.js";import{M as X,r as h,B as O,h as y,i as e,v as i,e as D,t as n,q as b,A as Z,p as E,s as g,j as x,f as p,o as ge,P as je,w as _e,d as z}from"./vendor-Mr6oR_SG.js";const we={class:"job-detail-modal"},De={class:"job-overview"},Ce={class:"job-header"},$e={class:"job-title"},Ae={key:0,class:"job-actions"},Ie={class:"job-metadata"},Te={class:"metadata-grid"},Me={class:"metadata-item"},ke={class:"metadata-item"},Fe={class:"metadata-item"},Se={key:0,class:"metadata-item"},Ne={class:"metadata-item"},Pe={key:1,class:"metadata-item"},Re={class:"job-progress"},Ee={class:"progress-grid"},Le={class:"progress-item"},Je={class:"progress-header"},Ve={class:"progress-value"},Ue={class:"progress-item"},Be={class:"progress-header"},ze={class:"progress-value"},Oe={class:"progress-item"},Ge={class:"progress-header"},He={class:"progress-value"},qe={class:"progress-item"},We={class:"progress-header"},Ye={class:"progress-value"},Ke={class:"statistics-summary"},Qe={class:"summary-item"},Xe={class:"summary-value"},Ze={key:0,class:"summary-item"},xe={class:"summary-value"},es={key:1,class:"summary-item"},ss={class:"summary-value"},ts={class:"job-activity"},os={class:"activity-display"},as={class:"activity-text"},ls={key:0,class:"pi pi-spin pi-spinner"},rs={key:1,class:"pi pi-check-circle"},is={key:2,class:"pi pi-times-circle"},ns={key:3,class:"pi pi-ban"},ds={key:0,class:"activity-time"},us={key:0,class:"job-error"},cs={class:"error-display"},vs={class:"error-content"},ps=X({__name:"JobDetailModal",props:{job:{}},emits:["refresh","cancel"],setup(B,{emit:w}){const d=B,I=w,C=h(!1),A=O(()=>{if(d.job.articlesProcessed>0&&d.job.elapsedTimeMs>0){const a=d.job.elapsedTimeMs/d.job.articlesProcessed;return j({elapsedTimeMs:a})}return null}),L=a=>{switch(a){case"RUNNING":return"info";case"COMPLETED":return"success";case"FAILED":return"danger";case"CANCELLED":return"warning";default:return"secondary"}},J=a=>`job-status-${a.toLowerCase()}`,F=a=>d.job.totalArticlesAttempted===0?0:(a==="processed"?d.job.articlesProcessed:a==="skipped"?d.job.articlesSkipped:d.job.articlesFailed)/d.job.totalArticlesAttempted*100,S=a=>new Date(a).toLocaleString(),T=a=>{const t=new Date(a),c=new Date().getTime()-t.getTime(),f=Math.floor(c/1e3),_=Math.floor(f/60),$=Math.floor(_/60);return f<60?`${f} seconds ago`:_<60?`${_} minutes ago`:$<24?`${$} hours ago`:t.toLocaleString()},j=a=>{const t=a.durationMs||a.elapsedTimeMs;if(!t)return"-";const u=Math.floor(t/1e3),c=Math.floor(u/60),f=Math.floor(c/60),_=Math.floor(f/24);return _>0?`${_}d ${f%24}h ${c%60}m`:f>0?`${f}h ${c%60}m ${u%60}s`:c>0?`${c}m ${u%60}s`:`${u}s`},m=a=>{const t=Math.floor(a/1e3),u=Math.floor(t/60),c=Math.floor(u/60);return c>0?`${c}h ${u%60}m ${t%60}s`:u>0?`${u}m ${t%60}s`:`${t}s`},M=()=>{I("cancel",d.job.jobId),C.value=!1};return(a,t)=>{const u=b("Badge"),c=b("Button"),f=b("Divider"),_=b("ProgressBar"),$=b("Message"),N=b("Dialog"),V=x("tooltip");return p(),y("div",we,[e("div",De,[e("div",Ce,[e("div",$e,[e("h4",null,n(a.job.jobId),1),i(u,{value:a.job.status,severity:L(a.job.status),class:Z(J(a.job.status))},null,8,["value","severity","class"])]),a.job.status==="RUNNING"?(p(),y("div",Ae,[E(i(c,{icon:"pi pi-refresh",severity:"secondary",size:"small",onClick:t[0]||(t[0]=P=>a.$emit("refresh"))},null,512),[[V,"Refresh",void 0,{top:!0}]]),E(i(c,{icon:"pi pi-times",severity:"danger",size:"small",onClick:t[1]||(t[1]=P=>C.value=!0)},null,512),[[V,"Cancel job",void 0,{top:!0}]])])):D("",!0)]),e("div",Ie,[e("div",Te,[e("div",Me,[t[4]||(t[4]=e("label",null,"Crawler ID",-1)),e("span",null,n(a.job.crawlerId),1)]),e("div",ke,[t[5]||(t[5]=e("label",null,"Request ID",-1)),e("span",null,n(a.job.requestId||"N/A"),1)]),e("div",Fe,[t[6]||(t[6]=e("label",null,"Started",-1)),e("span",null,n(S(a.job.startTime)),1)]),a.job.endTime?(p(),y("div",Se,[t[7]||(t[7]=e("label",null,"Ended",-1)),e("span",null,n(S(a.job.endTime)),1)])):D("",!0),e("div",Ne,[t[8]||(t[8]=e("label",null,"Duration",-1)),e("span",null,n(j(a.job)),1)]),a.job.lastUpdated?(p(),y("div",Pe,[t[9]||(t[9]=e("label",null,"Last Updated",-1)),e("span",null,n(S(a.job.lastUpdated)),1)])):D("",!0)])])]),i(f),e("div",Re,[t[20]||(t[20]=e("h5",null,"Progress & Statistics",-1)),e("div",Ee,[e("div",Le,[e("div",Je,[t[10]||(t[10]=e("span",{class:"progress-label"},"Articles Processed",-1)),e("span",Ve,n(a.job.articlesProcessed),1)]),i(_,{value:F("processed"),showValue:!1,class:"progress-bar success"},null,8,["value"])]),e("div",Ue,[e("div",Be,[t[11]||(t[11]=e("span",{class:"progress-label"},"Articles Skipped",-1)),e("span",ze,n(a.job.articlesSkipped),1)]),i(_,{value:F("skipped"),showValue:!1,class:"progress-bar warning"},null,8,["value"])]),e("div",Oe,[e("div",Ge,[t[12]||(t[12]=e("span",{class:"progress-label"},"Articles Failed",-1)),e("span",He,n(a.job.articlesFailed),1)]),i(_,{value:F("failed"),showValue:!1,class:"progress-bar danger"},null,8,["value"])]),e("div",qe,[e("div",We,[t[13]||(t[13]=e("span",{class:"progress-label"},"Success Rate",-1)),e("span",Ye,n(a.job.successRate.toFixed(1))+"%",1)]),i(_,{value:a.job.successRate,showValue:!1,class:"progress-bar info"},null,8,["value"])])]),e("div",Ke,[e("div",Qe,[t[15]||(t[15]=e("i",{class:"pi pi-chart-bar"},null,-1)),e("div",null,[t[14]||(t[14]=e("span",{class:"summary-label"},"Total Attempted",-1)),e("span",Xe,n(a.job.totalArticlesAttempted),1)])]),a.job.status==="RUNNING"?(p(),y("div",Ze,[t[17]||(t[17]=e("i",{class:"pi pi-clock"},null,-1)),e("div",null,[t[16]||(t[16]=e("span",{class:"summary-label"},"Elapsed Time",-1)),e("span",xe,n(m(a.job.elapsedTimeMs)),1)])])):D("",!0),A.value?(p(),y("div",es,[t[19]||(t[19]=e("i",{class:"pi pi-stopwatch"},null,-1)),e("div",null,[t[18]||(t[18]=e("span",{class:"summary-label"},"Avg. Processing Time",-1)),e("span",ss,n(A.value),1)])])):D("",!0)])]),i(f),e("div",ts,[t[21]||(t[21]=e("h5",null,"Current Activity",-1)),e("div",os,[e("div",as,[a.job.status==="RUNNING"?(p(),y("i",ls)):a.job.status==="COMPLETED"?(p(),y("i",rs)):a.job.status==="FAILED"?(p(),y("i",is)):a.job.status==="CANCELLED"?(p(),y("i",ns)):D("",!0),e("span",null,n(a.job.currentActivity||"No activity information"),1)]),a.job.lastUpdated?(p(),y("div",ds," Last updated: "+n(T(a.job.lastUpdated)),1)):D("",!0)])]),a.job.errorMessage?(p(),y("div",us,[i(f),t[22]||(t[22]=e("h5",null,"Error Details",-1)),e("div",cs,[i($,{severity:"error",closable:!1},{default:g(()=>[e("div",vs,[e("pre",null,n(a.job.errorMessage),1)])]),_:1})])])):D("",!0),i(N,{visible:C.value,"onUpdate:visible":t[3]||(t[3]=P=>C.value=P),header:"Cancel Job",modal:"",style:{width:"25rem"}},{footer:g(()=>[i(c,{label:"No",severity:"secondary",onClick:t[2]||(t[2]=P=>C.value=!1)}),i(c,{label:"Yes, Cancel Job",severity:"danger",onClick:M})]),default:g(()=>[t[23]||(t[23]=e("div",{class:"cancel-confirmation"},[e("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"var(--orange-500)"}}),e("div",null,[e("p",null,"Are you sure you want to cancel this job?"),e("p",{class:"cancel-warning"},"This action cannot be undone.")])],-1))]),_:1,__:[23]},8,["visible"])])}}}),bs=Q(ps,[["__scopeId","data-v-74647e78"]]),ms={class:"job-history"},fs={class:"job-history-header"},hs={class:"job-history-actions"},ys={class:"job-history-content"},gs={class:"job-start-time"},js={class:"job-articles"},_s={class:"articles-processed"},ws={key:0,class:"articles-failed"},Ds={class:"success-rate"},Cs={class:"success-rate-text"},$s={class:"job-duration"},As=["title"],Is={class:"job-actions"},Ts={class:"filter-form"},Ms={class:"field"},ks={class:"field"},Fs={class:"field"},Ss={class:"field"},Ns=X({__name:"JobHistory",props:{crawlerId:{},showPagination:{type:Boolean,default:!1},pageSize:{default:10},showActivityColumn:{type:Boolean,default:!0},autoRefresh:{type:Boolean,default:!0},refreshInterval:{default:3e4}},setup(B){const w=B,d=h([]),I=h(!1),C=h(!1),A=h(null),L=h(0),J=h(0),F=h("startTime"),S=h(-1),T=h(!1),j=h({status:[],dateFrom:void 0,dateTo:void 0,searchTerm:""}),m=h({}),M=h(!1),a=h(null);let t=null,u=[];const c=[{label:"Running",value:"RUNNING"},{label:"Completed",value:"COMPLETED"},{label:"Failed",value:"FAILED"},{label:"Cancelled",value:"CANCELLED"}],f=O(()=>{let s=[...d.value];if(m.value.status&&m.value.status.length>0&&(s=s.filter(o=>m.value.status.includes(o.status))),m.value.dateFrom){const o=new Date(m.value.dateFrom);s=s.filter(l=>new Date(l.startTime)>=o)}if(m.value.dateTo){const o=new Date(m.value.dateTo);o.setHours(23,59,59,999),s=s.filter(l=>new Date(l.startTime)<=o)}if(m.value.searchTerm){const o=m.value.searchTerm.toLowerCase();s=s.filter(l=>l.jobId.toLowerCase().includes(o)||l.currentActivity&&l.currentActivity.toLowerCase().includes(o))}return s}),_=O(()=>I.value?"Loading jobs...":A.value?`Error: ${A.value}`:Object.keys(m.value).length>0?"No jobs match the current filters":"No jobs found"),$=async(s=0)=>{try{I.value=!0,A.value=null;let o;w.showPagination?o=await R.getJobHistory(w.crawlerId,s,w.pageSize):o=await R.getRecentJobs(w.crawlerId),d.value=o,J.value=o.length,L.value=s}catch(o){A.value=o instanceof Error?o.message:"Failed to load jobs",console.error("Failed to load jobs:",o)}finally{I.value=!1}},N=async()=>{try{C.value=!0,await $(L.value)}finally{C.value=!1}},V=s=>{$(s.page)},P=s=>{F.value=s.sortField,S.value=s.sortOrder,d.value.sort((o,l)=>{const v=G(o,s.sortField),k=G(l,s.sortField);return v<k?-1*s.sortOrder:v>k?1*s.sortOrder:0})},G=(s,o)=>o.split(".").reduce((l,v)=>l&&l[v],s),ee=async s=>{try{const o=await R.getJobDetails(s.jobId);a.value=o,M.value=!0}catch(o){console.error("Failed to load job details:",o),a.value=s,M.value=!0}},H=async()=>{if(a.value)try{const s=await R.getJobDetails(a.value.jobId);a.value=s}catch(s){console.error("Failed to refresh job details:",s)}},se=async s=>{try{await R.cancelJob(s.jobId),await N()}catch(o){console.error("Failed to cancel job:",o),A.value=o instanceof Error?o.message:"Failed to cancel job"}},te=async s=>{try{await R.cancelJob(s),await H(),await N()}catch(o){console.error("Failed to cancel job:",o)}},oe=()=>{m.value={...j.value},T.value=!1},ae=()=>{j.value={status:[],dateFrom:void 0,dateTo:void 0,searchTerm:""},m.value={},T.value=!1},le=s=>{switch(s){case"RUNNING":return"info";case"COMPLETED":return"success";case"FAILED":return"danger";case"CANCELLED":return"warning";default:return"secondary"}},re=s=>`job-status-${s.toLowerCase()}`,ie=s=>new Date(s).toLocaleString(),ne=s=>{const o=s.durationMs||s.elapsedTimeMs;if(!o)return"-";const l=Math.floor(o/1e3),v=Math.floor(l/60),k=Math.floor(v/60);return k>0?`${k}h ${v%60}m`:v>0?`${v}m ${l%60}s`:`${l}s`},de=s=>s?s.length>30?s.substring(0,30)+"...":s:"-",q=()=>{u.forEach(s=>s()),u=[],u.push(ye.on("job:updated",s=>{s.crawlerId===w.crawlerId&&ue(s)}))},ue=s=>{const o=d.value.findIndex(l=>l.jobId===s.jobId);if(o!==-1){const l={...d.value[o]};l.status=s.status,l.lastUpdated=s.timestamp,s.progress&&(l.articlesProcessed=s.progress.articlesProcessed,l.articlesSkipped=s.progress.articlesSkipped,l.articlesFailed=s.progress.articlesFailed,l.currentActivity=s.progress.currentActivity,l.totalArticlesAttempted=s.progress.articlesProcessed+s.progress.articlesSkipped+s.progress.articlesFailed,l.totalArticlesAttempted>0&&(l.successRate=s.progress.articlesProcessed/l.totalArticlesAttempted*100)),d.value[o]=l,a.value&&a.value.jobId===s.jobId&&(a.value=l)}else if(s.type==="job.started"){const l={jobId:s.jobId,crawlerId:s.crawlerId,status:s.status,startTime:s.timestamp,articlesProcessed:0,articlesSkipped:0,articlesFailed:0,elapsedTimeMs:0,successRate:0,totalArticlesAttempted:0,currentActivity:"Starting..."};d.value.unshift(l),!w.showPagination&&d.value.length>10&&(d.value=d.value.slice(0,10))}},ce=()=>{w.autoRefresh&&w.refreshInterval>0&&(t=setInterval(()=>{!I.value&&!M.value&&N()},w.refreshInterval))},ve=()=>{t&&(clearInterval(t),t=null)};return ge(()=>{$(),q(),ce()}),je(()=>{u.forEach(s=>s()),ve()}),_e(()=>w.crawlerId,()=>{$(),q()}),(s,o)=>{var K;const l=b("Button"),v=b("Column"),k=b("Badge"),pe=b("ProgressBar"),be=b("DataTable"),W=b("Dialog"),me=b("MultiSelect"),Y=b("Calendar"),fe=b("InputText"),U=x("tooltip");return p(),y("div",ms,[e("div",fs,[o[7]||(o[7]=e("h3",null,"Job History",-1)),e("div",hs,[E(i(l,{icon:"pi pi-refresh",severity:"secondary",size:"small",onClick:N,loading:C.value},null,8,["loading"]),[[U,"Refresh job history",void 0,{top:!0}]]),E(i(l,{icon:"pi pi-filter",severity:"secondary",size:"small",onClick:o[0]||(o[0]=r=>T.value=!0)},null,512),[[U,"Filter jobs",void 0,{top:!0}]])])]),e("div",ys,[i(be,{value:f.value,loading:I.value,paginator:s.showPagination,rows:s.pageSize,totalRecords:J.value,lazy:s.showPagination,onPage:V,onSort:P,sortMode:"single",sortField:F.value,sortOrder:S.value,size:"small",stripedRows:"",responsiveLayout:"scroll",emptyMessage:_.value,class:"job-history-table"},{default:g(()=>[i(v,{field:"startTime",header:"Started",sortable:""},{body:g(({data:r})=>[e("span",gs,n(ie(r.startTime)),1)]),_:1}),i(v,{field:"status",header:"Status",sortable:""},{body:g(({data:r})=>[i(k,{value:r.status,severity:le(r.status),class:Z(re(r.status))},null,8,["value","severity","class"])]),_:1}),i(v,{field:"articlesProcessed",header:"Articles",sortable:""},{body:g(({data:r})=>[e("div",js,[e("span",_s,n(r.articlesProcessed),1),r.articlesFailed>0?(p(),y("span",ws," ("+n(r.articlesFailed)+" failed) ",1)):D("",!0)])]),_:1}),i(v,{field:"successRate",header:"Success Rate",sortable:""},{body:g(({data:r})=>[e("div",Ds,[i(pe,{value:r.successRate,showValue:!1,class:"success-rate-bar"},null,8,["value"]),e("span",Cs,n(r.successRate.toFixed(1))+"%",1)])]),_:1}),i(v,{field:"durationMs",header:"Duration",sortable:""},{body:g(({data:r})=>[e("span",$s,n(ne(r)),1)]),_:1}),s.showActivityColumn?(p(),z(v,{key:0,field:"currentActivity",header:"Activity"},{body:g(({data:r})=>[e("span",{class:"job-activity",title:r.currentActivity},n(de(r.currentActivity)),9,As)]),_:1})):D("",!0),i(v,{header:"Actions",exportable:!1},{body:g(({data:r})=>[e("div",Is,[E(i(l,{icon:"pi pi-eye",severity:"info",size:"small",text:"",onClick:he=>ee(r)},null,8,["onClick"]),[[U,"View details",void 0,{top:!0}]]),r.status==="RUNNING"?E((p(),z(l,{key:0,icon:"pi pi-times",severity:"danger",size:"small",text:"",onClick:he=>se(r)},null,8,["onClick"])),[[U,"Cancel job",void 0,{top:!0}]]):D("",!0)])]),_:1})]),_:1},8,["value","loading","paginator","rows","totalRecords","lazy","sortField","sortOrder","emptyMessage"])]),i(W,{visible:M.value,"onUpdate:visible":o[1]||(o[1]=r=>M.value=r),header:`Job Details - ${(K=a.value)==null?void 0:K.jobId}`,modal:"",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:g(()=>[a.value?(p(),z(bs,{key:0,job:a.value,onRefresh:H,onCancel:te},null,8,["job"])):D("",!0)]),_:1},8,["visible","header"]),i(W,{visible:T.value,"onUpdate:visible":o[6]||(o[6]=r=>T.value=r),header:"Filter Jobs",modal:"",style:{width:"30rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{footer:g(()=>[i(l,{label:"Clear",severity:"secondary",onClick:ae}),i(l,{label:"Apply",onClick:oe})]),default:g(()=>[e("div",Ts,[e("div",Ms,[o[8]||(o[8]=e("label",{for:"status-filter"},"Status",-1)),i(me,{id:"status-filter",modelValue:j.value.status,"onUpdate:modelValue":o[2]||(o[2]=r=>j.value.status=r),options:c,optionLabel:"label",optionValue:"value",placeholder:"Select statuses",class:"w-full"},null,8,["modelValue"])]),e("div",ks,[o[9]||(o[9]=e("label",{for:"date-from"},"Date From",-1)),i(Y,{id:"date-from",modelValue:j.value.dateFrom,"onUpdate:modelValue":o[3]||(o[3]=r=>j.value.dateFrom=r),showIcon:"",dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),e("div",Fs,[o[10]||(o[10]=e("label",{for:"date-to"},"Date To",-1)),i(Y,{id:"date-to",modelValue:j.value.dateTo,"onUpdate:modelValue":o[4]||(o[4]=r=>j.value.dateTo=r),showIcon:"",dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),e("div",Ss,[o[11]||(o[11]=e("label",{for:"search-term"},"Search",-1)),i(fe,{id:"search-term",modelValue:j.value.searchTerm,"onUpdate:modelValue":o[5]||(o[5]=r=>j.value.searchTerm=r),placeholder:"Search in job ID or activity",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible"])])}}}),Es=Q(Ns,[["__scopeId","data-v-4fbc82fb"]]);export{Es as J,bs as a};
