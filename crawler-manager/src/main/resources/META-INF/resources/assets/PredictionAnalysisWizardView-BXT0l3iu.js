var Me=Object.defineProperty;var Fe=(D,t,a)=>t in D?Me(D,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):D[t]=a;var B=(D,t,a)=>Fe(D,typeof t!="symbol"?t+"":t,a);import{M as Z,r as C,B as L,w as H,o as ne,h as _,v as y,N as u,s as N,i as e,e as P,F as ae,y as le,d as j,z as ie,t as E,p as X,j as xe,f,P as Ae,K as Te,A as re,C as Le,m as Pe,k as Oe,Q as Ue,X as Je}from"./vendor-Mr6oR_SG.js";import{a as ge,A as se,f as ve,_ as ee,h as Ge}from"./index-DZVWbUD3.js";import{o as Q,l as oe,g as M,i as me,a1 as Be,a2 as We,a3 as we}from"./primevue-COZmI4QV.js";import{s as je}from"./index-BQov9KEr.js";import{s as Ye}from"./index-CdxwA4cm.js";import{s as ye}from"./index-CDzoV1Ol.js";import{A as Ke,a as qe}from"./ArticleSelectionTable-BLF2GrzS.js";import{s as He}from"./index-BpsDegm3.js";import{s as Xe}from"./index-CMl7L9aA.js";import{s as _e}from"./index-B87idtjP.js";import"./index-RJ29EJqU.js";import"./index-DY9hXYNa.js";import"./debounce-BMmXVQ06.js";import"./index-Dp75atdH.js";class he{createValidation(t,a=[],r=[]){return{isValid:t,errors:a,warnings:r}}validateRequired(t,a){return t==null||t===""?`${a} is required`:null}validateMinLength(t,a,r){return t&&t.length<a?`${r} must be at least ${a} characters`:null}validateArray(t,a,r){return!Array.isArray(t)||t.length<a?`${r} must contain at least ${a} items`:null}}class Ee extends he{validate(t){const a=[],r=[],o=t.selectedArticles||[];(!Array.isArray(o)||o.length===0)&&a.push("At least one article must be selected for analysis"),o.length>100&&r.push("Large article selections may take longer to process");const s=o.filter(S=>!S.id||!S.title||!S.text);return s.length>0&&a.push(`${s.length} selected articles have missing required data`),this.createValidation(a.length===0,a,r)}}class Qe extends he{validate(t){const a=[],r=[],o=t.currentJob;return o?(o.status==="FAILED"?a.push("Analysis job failed and must be retried"):o.status==="CANCELLED"?a.push("Analysis job was cancelled and must be restarted"):o.status!=="COMPLETED"&&a.push("Analysis job must be completed before proceeding"),o.status==="COMPLETED"&&((!o.processedArticles||o.processedArticles===0)&&r.push("No articles were processed in the analysis"),(!o.predictionsFound||o.predictionsFound===0)&&r.push("No predictions were found in the analyzed articles")),this.createValidation(a.length===0,a,r)):(a.push("Analysis job must be started"),this.createValidation(!1,a,r))}}class Ze extends he{validate(t){const a=[],r=[],o=t.results||[];if(!Array.isArray(o))return a.push("Invalid results data format"),this.createValidation(!1,a,r);o.length===0&&r.push("No prediction results to display");const s=o.filter(S=>!S.id||!S.predictionText||!S.article);return s.length>0&&a.push(`${s.length} results have missing required data`),this.createValidation(a.length===0,a,r)}}class et{canLeave(t){return(t.selectedArticles||[]).length>0}canEnter(){return!0}async beforeLeave(t){const a=t.selectedArticles||[];console.log(`Leaving article selection with ${a.length} articles selected`)}}class tt{canLeave(t){const a=t.currentJob;return a&&a.status==="COMPLETED"}canEnter(t){return(t.selectedArticles||[]).length>0}async beforeLeave(t){const a=t.currentJob;if(a&&a.status==="RUNNING")throw new Error("Cannot leave while analysis is running")}}class st{canLeave(){return!0}canEnter(t){const a=t.currentJob;return a&&a.status==="COMPLETED"}}class pe{static createArticleSelectionStep(){return{id:"article-selection",title:"Select Articles",description:"Choose articles for analysis",component:null,validation:new Ee,navigationGuard:new et,dependencies:[],optional:!1}}static createAnalysisExecutionStep(){return{id:"analysis-execution",title:"Run Analysis",description:"Execute prediction analysis",component:null,validation:new Qe,navigationGuard:new tt,dependencies:["article-selection"],optional:!1}}static createAnalysisResultsStep(){return{id:"analysis-results",title:"View Results",description:"Review analysis results",component:null,validation:new Ze,navigationGuard:new st,dependencies:["article-selection","analysis-execution"],optional:!1}}}class at{static async validateAllSteps(t,a){const r=new Map;for(const o of t){const s=a.get(o.id);if(s){const S=await o.validation.validate(s.data);r.set(o.id,S)}}return r}static checkStepDependencies(t,a,r){const o=a.find(s=>s.id===t);return!o||!o.dependencies?!0:o.dependencies.every(s=>{const S=r.get(s);return S&&S.isComplete})}static getNextAvailableStep(t,a,r){const o=a.findIndex(s=>s.id===t);if(o===-1)return null;for(let s=o+1;s<a.length;s++){const S=a[s];if(this.checkStepDependencies(S.id,a,r))return S.id}return null}static getPreviousAvailableStep(t,a){const r=a.findIndex(o=>o.id===t);return r<=0?null:a[r-1].id}}const lt={class:"article-selection-step"},it={class:"flex align-items-center justify-content-between w-full"},rt={class:"flex align-items-center gap-2"},ot={class:"step-description"},nt={key:0,class:"validation-messages mb-3"},ct={key:1,class:"validation-messages mb-3"},dt={key:2,class:"selection-info"},ut={class:"flex align-items-center gap-2 text-sm text-600"},vt={key:0,class:"text-orange-600 font-medium"},pt={key:1},mt={class:"flex align-items-center justify-content-between w-full"},yt={class:"flex align-items-center gap-2"},ft={class:"flex align-items-center gap-2"},gt=Z({__name:"ArticleSelectionStep",props:{wizardState:{},stepData:{},isActive:{type:Boolean}},emits:["step-valid","step-complete","step-data"],setup(D,{emit:t}){const a=D,r=t,o=ge(),s=C([]),S=C([]),h=C([]),z=C(!1),w=C(!1),c=C([]),b=C([]),p=C({authorId:null,titleSearch:"",dateRange:null,crawlerSource:null}),$=new Ee,d=L(()=>{let g=[...S.value];if(p.value.authorId&&(g=g.filter(m=>{var F;return((F=m.author)==null?void 0:F.id)===p.value.authorId})),p.value.titleSearch){const m=p.value.titleSearch.toLowerCase();g=g.filter(F=>F.title.toLowerCase().includes(m))}if(p.value.dateRange&&p.value.dateRange.length===2){const[m,F]=p.value.dateRange;g=g.filter(n=>{const i=new Date(n.createdAt);return i>=m&&i<=F})}return p.value.crawlerSource&&(g=g.filter(m=>m.crawlerSource===p.value.crawlerSource)),g}),v=L(()=>Math.ceil(s.value.length/10)),U=async g=>{p.value={...g},await Y()},x=g=>{s.value=[...g],G(),O()},W=()=>{s.value=[],G(),O(),o.add({severity:"info",summary:"Selection Cleared",detail:"All article selections have been cleared",life:2e3})},J=async()=>{w.value=!0;try{await Y(),o.add({severity:"success",summary:"Success",detail:"Articles refreshed successfully",life:3e3})}catch(g){console.error("Error refreshing articles:",g);const m=g instanceof ve?g.message:"Failed to refresh articles";o.add({severity:"error",summary:"Error",detail:m,life:5e3})}finally{w.value=!1}},Y=async()=>{var g,m,F,n;z.value=!0;try{const i={authorId:p.value.authorId,titleSearch:p.value.titleSearch||void 0,fromDate:(m=(g=p.value.dateRange)==null?void 0:g[0])==null?void 0:m.toISOString(),toDate:(n=(F=p.value.dateRange)==null?void 0:F[1])==null?void 0:n.toISOString(),page:0,size:1e3};Object.keys(i).forEach(R=>{(i[R]===void 0||i[R]===null)&&delete i[R]});const k=await se.getArticlesForAnalysis(i,{retries:2});S.value=k.articles.map(R=>({id:R.id,title:R.title,url:R.url,text:R.text,crawlerSource:R.crawlerSource,createdAt:R.createdAt,author:R.author?{id:R.author.id,name:R.author.name,avatarUrl:R.author.avatarUrl}:void 0,predictions:R.predictionInstances||[]}))}catch(i){console.error("Error loading articles:",i);const k=i instanceof ve?i.message:"Failed to load articles";o.add({severity:"error",summary:"Error Loading Articles",detail:k,life:5e3}),S.value=[]}finally{z.value=!1}},te=async()=>{try{const g=await se.getAllAuthors({retries:2});h.value=g.map(m=>({id:m.author.id,name:m.author.name,avatarUrl:m.author.avatarUrl,articleCount:m.articleCount}))}catch(g){console.error("Error loading authors:",g);const m=g instanceof ve?g.message:"Failed to load authors";o.add({severity:"warn",summary:"Warning",detail:m,life:3e3}),h.value=[]}},G=()=>{const g={selectedArticles:s.value,filters:p.value},m=$.validate(g);return c.value=m.errors,b.value=m.warnings,r("step-valid",m.isValid),m.isValid&&r("step-complete","article-selection"),m},O=()=>{const g={selectedArticles:s.value,filters:p.value,totalAvailableArticles:d.value.length};r("step-data",g)};H(s,()=>{G(),O()},{deep:!0}),H(p,()=>{O()},{deep:!0});const q=()=>{var g,m;(g=a.wizardState)!=null&&g.selectedArticles&&(s.value=[...a.wizardState.selectedArticles]),(m=a.wizardState)!=null&&m.filters&&(p.value={...a.wizardState.filters})};return ne(async()=>{try{q(),await te(),await Y(),G()}catch(g){console.error("Error initializing article selection step:",g),o.add({severity:"error",summary:"Initialization Error",detail:"Failed to initialize article selection",life:5e3})}}),H(()=>a.wizardState,g=>{g&&a.isActive&&q()},{deep:!0}),(g,m)=>{const F=xe("tooltip");return f(),_("div",lt,[y(u(Q),{class:"mb-4"},{header:N(()=>[e("div",it,[m[0]||(m[0]=e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-list mr-2 text-primary"}),e("span",{class:"font-semibold"},"Select Articles for Analysis")],-1)),e("div",rt,[y(u(oe),{value:s.value.length,severity:s.value.length>0?"success":"info"},null,8,["value","severity"]),y(u(je),{label:`${s.value.length} of ${d.value.length} selected`,class:"selection-summary"},null,8,["label"])])])]),default:N(()=>[e("div",ot,[m[2]||(m[2]=e("div",{class:"text-600 mb-3"}," Choose articles from the list below to analyze for predictions. You can filter articles by author, title, date range, or source. ",-1)),c.value.length>0?(f(),_("div",nt,[(f(!0),_(ae,null,le(c.value,n=>(f(),j(u(ye),{key:n,severity:"error",closable:!1,class:"mb-2"},{default:N(()=>[ie(E(n),1)]),_:2},1024))),128))])):P("",!0),b.value.length>0?(f(),_("div",ct,[(f(!0),_(ae,null,le(b.value,n=>(f(),j(u(ye),{key:n,severity:"warn",closable:!1,class:"mb-2"},{default:N(()=>[ie(E(n),1)]),_:2},1024))),128))])):P("",!0),s.value.length>0?(f(),_("div",dt,[e("div",ut,[m[1]||(m[1]=e("i",{class:"pi pi-info-circle text-blue-500"},null,-1)),s.value.length>100?(f(),_("span",vt," Large batch analysis may take several minutes ")):(f(),_("span",pt," Estimated analysis time: "+E(v.value)+" minutes ",1))])])):P("",!0)])]),_:1}),y(Ke,{filters:p.value,authors:h.value,onFilterChanged:U,class:"mb-4"},null,8,["filters","authors"]),y(u(Q),{class:"article-table-panel"},{header:N(()=>[e("div",mt,[e("div",yt,[m[3]||(m[3]=e("i",{class:"pi pi-table text-primary"},null,-1)),m[4]||(m[4]=e("span",{class:"font-semibold"},"Available Articles",-1)),s.value.length>0?(f(),j(u(Ye),{key:0,value:`${s.value.length} selected`,severity:"success"},null,8,["value"])):P("",!0)]),e("div",ft,[X(y(u(M),{icon:"pi pi-refresh",label:"Refresh",size:"small",severity:"secondary",outlined:"",onClick:J,loading:w.value},null,8,["loading"]),[[F,"Refresh article list",void 0,{top:!0}]]),s.value.length>0?X((f(),j(u(M),{key:0,icon:"pi pi-times",label:"Clear Selection",size:"small",severity:"secondary",outlined:"",onClick:W},null,512)),[[F,"Clear all selected articles",void 0,{top:!0}]]):P("",!0)])])]),default:N(()=>[y(qe,{articles:d.value,"selected-articles":s.value,loading:z.value,onSelectionChanged:x,onRefreshArticles:J,class:"wizard-article-table"},null,8,["articles","selected-articles","loading"])]),_:1})])}}}),ht=ee(gt,[["__scopeId","data-v-314bb023"]]),bt={class:"analysis-execution-step"},St={key:0,class:"analysis-config p-4"},wt={class:"grid"},xt={class:"col-12 md:col-6"},At={class:"field"},_t={class:"col-12 md:col-6"},Et={class:"field"},$t={class:"field-checkbox mb-4"},Ct={class:"selected-articles-summary mb-4"},Dt={class:"text-600"},Rt={key:0,class:"text-red-500 text-sm mt-1"},kt={class:"text-center"},zt={key:1,class:"analysis-progress p-4"},It={class:"text-center mb-4"},Vt={class:"text-2xl font-semibold text-900 mb-2"},Nt={class:"text-600 mb-2"},Mt={class:"text-sm text-500"},Ft={key:0,class:"progress-section mb-4"},Tt={class:"flex justify-content-between align-items-center mb-2"},Lt={class:"text-600"},Pt={class:"grid text-center"},Ot={class:"col-4"},Ut={class:"text-2xl font-bold text-primary"},Jt={class:"col-4"},Gt={class:"text-2xl font-bold text-green-500"},Bt={class:"col-4"},Wt={class:"text-2xl font-bold text-600"},jt={key:0,class:"current-activity mt-3 p-3 border-round surface-100"},Yt={class:"flex align-items-center"},Kt={class:"text-sm"},qt={key:1,class:"success-state text-center mb-4"},Ht={class:"text-600 mb-3"},Xt={class:"text-sm text-500"},Qt={key:2,class:"error-state text-center mb-4"},Zt={key:0,class:"text-600 mb-3"},es={class:"flex justify-content-center gap-2"},ts={key:3,class:"cancelled-state text-center mb-4"},ss={class:"action-buttons text-center"},as={class:"flex align-items-start mb-3"},ls={class:"text-600"},is=Z({__name:"AnalysisExecutionStep",props:{wizardState:{},stepData:{},isActive:{type:Boolean}},emits:["step-valid","step-complete","step-data","navigate-to"],setup(D,{emit:t}){const a=D,r=t,o=ge(),s=C(null),S=C(!1),h=C(!1),z=C(!1),w=C(!1),c=C(!1),b=C(""),p=C(""),$=C(null),d=C(null),v=C({analysisType:"gemini",batchSize:10,enableNotifications:!0}),U=[{label:"Gemini AI (Recommended)",value:"gemini"},{label:"Mock Analysis (Testing)",value:"mock"}],x=L(()=>{var n,i;return((i=(n=a.wizardState)==null?void 0:n.selectedArticles)==null?void 0:i.length)||0}),W=L(()=>!s.value||!s.value.totalArticles?0:Math.round(s.value.processedArticles/s.value.totalArticles*100)),J=async()=>{var n,i;if(x.value===0){o.add({severity:"warn",summary:"No Articles Selected",detail:"Please select articles before starting analysis",life:3e3});return}S.value=!0,b.value="";try{const k=a.wizardState.selectedArticles.map(ce=>ce.id),R=await se.startAnalysis(k,v.value.analysisType);R&&(s.value={id:R.id,jobId:R.jobId,status:R.status,totalArticles:R.totalArticles,processedArticles:R.processedArticles||0,predictionsFound:R.predictionsFound||0,startedAt:R.startedAt||new Date().toISOString()},r("step-data",{currentJob:s.value,analysisConfig:v.value}),Y(),v.value.enableNotifications&&te(),o.add({severity:"success",summary:"Analysis Started",detail:`Analysis job ${s.value.jobId} has been started`,life:3e3}))}catch(k){console.error("Failed to start analysis:",k),b.value=((i=(n=k.response)==null?void 0:n.data)==null?void 0:i.error)||"Failed to start analysis",c.value=!0,o.add({severity:"error",summary:"Analysis Failed",detail:b.value,life:5e3})}finally{S.value=!1}},Y=()=>{d.value&&clearInterval(d.value),d.value=setInterval(async()=>{if(!s.value||s.value.status!=="RUNNING"){clearInterval(d.value);return}try{const n=await se.getAnalysisJobStatus(s.value.jobId);n&&(s.value={...s.value,status:n.status,processedArticles:n.processedArticles||0,predictionsFound:n.predictionsFound||0,completedAt:n.completedAt,errorMessage:n.errorMessage},n.status==="RUNNING"?p.value=`Processing article ${s.value.processedArticles+1} of ${s.value.totalArticles}...`:p.value="",r("step-data",{currentJob:s.value,analysisConfig:v.value}),n.status==="COMPLETED"?(clearInterval(d.value),r("step-valid",!0),r("step-complete","analysis-execution"),o.add({severity:"success",summary:"Analysis Completed",detail:`Found ${s.value.predictionsFound} predictions`,life:5e3})):n.status==="FAILED"&&(clearInterval(d.value),b.value=n.errorMessage||"Analysis failed",o.add({severity:"error",summary:"Analysis Failed",detail:b.value,life:5e3})))}catch(n){console.error("Failed to fetch job status:",n)}},2e3)},te=()=>{try{console.log("WebSocket notifications would be set up here")}catch(n){console.error("Failed to setup WebSocket:",n)}},G=async()=>{var n,i;if(s.value){h.value=!0,w.value=!1;try{await se.cancelAnalysisJob(s.value.jobId),s.value.status="CANCELLED",s.value.cancelledAt=new Date().toISOString(),d.value&&clearInterval(d.value),r("step-data",{currentJob:s.value,analysisConfig:v.value}),o.add({severity:"info",summary:"Analysis Cancelled",detail:"The analysis job has been cancelled",life:3e3})}catch(k){console.error("Failed to cancel analysis:",k),o.add({severity:"error",summary:"Cancellation Failed",detail:((i=(n=k.response)==null?void 0:n.data)==null?void 0:i.error)||"Failed to cancel analysis",life:5e3})}finally{h.value=!1}}},O=async()=>{z.value=!0,c.value=!1,s.value=null,b.value="",await J(),z.value=!1},q=()=>{s.value=null,b.value="",p.value="",d.value&&clearInterval(d.value),$.value&&($.value.close(),$.value=null),r("step-data",{currentJob:null,analysisConfig:v.value}),r("step-valid",!1)},g=()=>{r("navigate-to","analysis-results")},m=()=>{var n;switch((n=s.value)==null?void 0:n.status){case"RUNNING":return"Analysis in Progress";case"COMPLETED":return"Analysis Completed";case"FAILED":return"Analysis Failed";case"CANCELLED":return"Analysis Cancelled";default:return"Unknown Status"}},F=n=>n?new Date(n).toLocaleString():"";return H(()=>{var n;return(n=s.value)==null?void 0:n.status},n=>{r("step-valid",n==="COMPLETED")}),H(()=>a.isActive,n=>{var i;n&&((i=s.value)==null?void 0:i.status)==="RUNNING"?Y():!n&&d.value&&clearInterval(d.value)}),ne(()=>{var n,i;(n=a.wizardState)!=null&&n.currentJob&&(s.value=a.wizardState.currentJob,s.value.status==="COMPLETED"?r("step-valid",!0):s.value.status==="RUNNING"&&Y()),(i=a.wizardState)!=null&&i.analysisConfig&&(v.value={...v.value,...a.wizardState.analysisConfig})}),Ae(()=>{d.value&&clearInterval(d.value),$.value&&$.value.close()}),(n,i)=>(f(),_("div",bt,[y(u(Q),null,{header:N(()=>i[8]||(i[8]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-cog mr-2 text-primary"}),e("span",{class:"font-semibold"},"Execute Analysis")],-1)])),default:N(()=>[s.value?(f(),_("div",zt,[e("div",It,[e("div",Vt,E(m()),1),e("div",Nt,"Job ID: "+E(s.value.jobId),1),e("div",Mt," Started: "+E(F(s.value.startedAt)),1)]),s.value.status==="RUNNING"?(f(),_("div",Ft,[e("div",Tt,[i[14]||(i[14]=e("span",{class:"text-900 font-medium"},"Progress",-1)),e("span",Lt,E(W.value)+"%",1)]),y(u(He),{value:W.value,class:"mb-3"},null,8,["value"]),e("div",Pt,[e("div",Ot,[e("div",Ut,E(s.value.processedArticles),1),i[15]||(i[15]=e("div",{class:"text-sm text-600"},"Processed",-1))]),e("div",Jt,[e("div",Gt,E(s.value.predictionsFound||0),1),i[16]||(i[16]=e("div",{class:"text-sm text-600"},"Predictions Found",-1))]),e("div",Bt,[e("div",Wt,E(s.value.totalArticles),1),i[17]||(i[17]=e("div",{class:"text-sm text-600"},"Total Articles",-1))])]),p.value?(f(),_("div",jt,[e("div",Yt,[y(u(_e),{style:{width:"20px",height:"20px"},strokeWidth:"4",class:"mr-2"}),e("span",Kt,E(p.value),1)])])):P("",!0)])):P("",!0),s.value.status==="COMPLETED"?(f(),_("div",qt,[i[18]||(i[18]=e("div",{class:"text-green-500 mb-3"},[e("i",{class:"pi pi-check-circle text-6xl"})],-1)),i[19]||(i[19]=e("div",{class:"text-xl font-semibold text-900 mb-2"},"Analysis Completed Successfully!",-1)),e("div",Ht," Found "+E(s.value.predictionsFound||0)+" predictions in "+E(s.value.processedArticles)+" articles ",1),e("div",Xt," Completed: "+E(F(s.value.completedAt)),1)])):P("",!0),s.value.status==="FAILED"?(f(),_("div",Qt,[i[20]||(i[20]=e("div",{class:"text-red-500 mb-3"},[e("i",{class:"pi pi-times-circle text-6xl"})],-1)),i[21]||(i[21]=e("div",{class:"text-xl font-semibold text-900 mb-2"},"Analysis Failed",-1)),b.value?(f(),_("div",Zt,E(b.value),1)):P("",!0),e("div",es,[y(u(M),{label:"Retry Analysis",icon:"pi pi-refresh",onClick:O,loading:z.value,class:"p-button-outlined"},null,8,["loading"]),y(u(M),{label:"Start New Analysis",icon:"pi pi-plus",onClick:q,class:"p-button-outlined p-button-secondary"})])])):P("",!0),s.value.status==="CANCELLED"?(f(),_("div",ts,[i[22]||(i[22]=e("div",{class:"text-orange-500 mb-3"},[e("i",{class:"pi pi-ban text-6xl"})],-1)),i[23]||(i[23]=e("div",{class:"text-xl font-semibold text-900 mb-2"},"Analysis Cancelled",-1)),i[24]||(i[24]=e("div",{class:"text-600 mb-3"}," The analysis was cancelled by user request ",-1)),y(u(M),{label:"Start New Analysis",icon:"pi pi-plus",onClick:q,class:"p-button-outlined"})])):P("",!0),e("div",ss,[s.value.status==="RUNNING"?(f(),j(u(M),{key:0,label:"Cancel Analysis",icon:"pi pi-times",onClick:i[3]||(i[3]=k=>w.value=!0),class:"p-button-outlined p-button-danger",loading:h.value},null,8,["loading"])):P("",!0),s.value.status==="COMPLETED"?(f(),j(u(M),{key:1,label:"View Results",icon:"pi pi-eye",onClick:g,class:"p-button-outlined p-button-success"})):P("",!0)])])):(f(),_("div",St,[e("div",wt,[e("div",xt,[e("div",At,[i[9]||(i[9]=e("label",{for:"analysisType",class:"block text-900 font-medium mb-2"},"Analysis Type",-1)),y(u(Xe),{id:"analysisType",modelValue:v.value.analysisType,"onUpdate:modelValue":i[0]||(i[0]=k=>v.value.analysisType=k),options:U,optionLabel:"label",optionValue:"value",placeholder:"Select analysis type",class:"w-full"},null,8,["modelValue"])])]),e("div",_t,[e("div",Et,[i[10]||(i[10]=e("label",{for:"batchSize",class:"block text-900 font-medium mb-2"},"Batch Size",-1)),y(u(Be),{id:"batchSize",modelValue:v.value.batchSize,"onUpdate:modelValue":i[1]||(i[1]=k=>v.value.batchSize=k),min:1,max:50,placeholder:"Articles per batch",class:"w-full"},null,8,["modelValue"])])])]),e("div",$t,[y(u(We),{id:"enableNotifications",modelValue:v.value.enableNotifications,"onUpdate:modelValue":i[2]||(i[2]=k=>v.value.enableNotifications=k),binary:!0},null,8,["modelValue"]),i[11]||(i[11]=e("label",{for:"enableNotifications",class:"ml-2"},"Enable real-time notifications",-1))]),e("div",Ct,[i[13]||(i[13]=e("div",{class:"text-900 font-medium mb-2"},"Selected Articles",-1)),e("div",Dt,E(x.value)+" articles selected for analysis ",1),x.value===0?(f(),_("div",Rt,i[12]||(i[12]=[e("i",{class:"pi pi-exclamation-triangle mr-1"},null,-1),ie(" No articles selected. Please go back to select articles. ",-1)]))):P("",!0)]),e("div",kt,[y(u(M),{label:"Start Analysis",icon:"pi pi-play",onClick:J,loading:S.value,disabled:x.value===0,class:"p-button-lg"},null,8,["loading","disabled"])])]))]),_:1}),y(u(me),{visible:w.value,"onUpdate:visible":i[5]||(i[5]=k=>w.value=k),modal:"",header:"Cancel Analysis",style:{width:"450px"}},{footer:N(()=>[y(u(M),{label:"Keep Running",onClick:i[4]||(i[4]=k=>w.value=!1),class:"p-button-outlined"}),y(u(M),{label:"Cancel Analysis",onClick:G,class:"p-button-danger",loading:h.value},null,8,["loading"])]),default:N(()=>[i[25]||(i[25]=e("div",{class:"flex align-items-center mb-3"},[e("i",{class:"pi pi-exclamation-triangle text-orange-500 text-2xl mr-3"}),e("span",null,"Are you sure you want to cancel the running analysis?")],-1)),i[26]||(i[26]=e("div",{class:"text-600 text-sm mb-4"}," This action cannot be undone. Any progress will be lost. ",-1))]),_:1,__:[25,26]},8,["visible"]),y(u(me),{visible:c.value,"onUpdate:visible":i[7]||(i[7]=k=>c.value=k),modal:"",header:"Analysis Error",style:{width:"500px"}},{footer:N(()=>[y(u(M),{label:"Close",onClick:i[6]||(i[6]=k=>c.value=!1),class:"p-button-outlined"}),y(u(M),{label:"Retry",onClick:O,loading:z.value},null,8,["loading"])]),default:N(()=>[e("div",as,[i[28]||(i[28]=e("i",{class:"pi pi-times-circle text-red-500 text-2xl mr-3 mt-1"},null,-1)),e("div",null,[i[27]||(i[27]=e("div",{class:"font-semibold mb-2"},"Analysis Failed",-1)),e("div",ls,E(b.value),1)])])]),_:1},8,["visible"])]))}}),rs=ee(is,[["__scopeId","data-v-1aa07f0c"]]),os={class:"analysis-results-step"},ns={class:"p-4"},cs={key:0,class:"text-center p-6"},ds={key:1},us={class:"results-summary mb-4"},vs={class:"grid"},ps={class:"col-12 md:col-4"},ms={class:"surface-card p-3 border-round"},ys={class:"text-2xl font-bold text-primary"},fs={class:"col-12 md:col-4"},gs={class:"surface-card p-3 border-round"},hs={class:"text-2xl font-bold text-primary"},bs={class:"col-12 md:col-4"},Ss={class:"surface-card p-3 border-round"},ws={class:"text-2xl font-bold text-primary"},xs={class:"results-list"},As={class:"surface-card p-3 border-round"},_s={class:"flex align-items-start justify-content-between"},Es={class:"flex-1"},$s={class:"font-medium mb-2"},Cs={class:"text-sm text-600 mb-2"},Ds={class:"flex align-items-center gap-2"},Rs={class:"results-actions mt-4 text-center"},ks=Z({__name:"AnalysisResultsStep",props:{wizardState:{},stepData:{},isActive:{type:Boolean}},emits:["step-valid","step-complete","step-data"],setup(D,{emit:t}){const a=D,r=t,o=Te("wizardContext"),s=C([]),S=L(()=>s.value.length>0),h=L(()=>new Set(s.value.map(d=>d.article.id)).size),z=L(()=>{if(s.value.length===0)return 0;const $=s.value.reduce((d,v)=>d+v.confidenceScore,0);return Math.round($/s.value.length)}),w=()=>{var d;const $=((d=a.wizardState)==null?void 0:d.selectedArticles)||[];s.value=$.flatMap((v,U)=>[{id:`pred-${v.id}-1`,predictionText:`Prediction ${U+1}A: This will happen within 6 months`,confidenceScore:Math.floor(Math.random()*40)+60,rating:["HIGH","MEDIUM","LOW"][Math.floor(Math.random()*3)],article:{id:v.id,title:v.title},extractedAt:new Date().toISOString()},{id:`pred-${v.id}-2`,predictionText:`Prediction ${U+1}B: Market will respond positively`,confidenceScore:Math.floor(Math.random()*40)+60,rating:["HIGH","MEDIUM","LOW"][Math.floor(Math.random()*3)],article:{id:v.id,title:v.title},extractedAt:new Date().toISOString()}]),r("step-data",{results:s.value}),r("step-valid",!0),r("step-complete","analysis-results")},c=$=>{switch($){case"HIGH":return"success";case"MEDIUM":return"warning";case"LOW":return"danger";default:return"info"}},b=()=>{o!=null&&o.goToStep&&o.goToStep(1)},p=()=>{console.log("Navigate to full results view")};return ne(()=>{var $,d,v;($=a.wizardState)!=null&&$.results&&(s.value=a.wizardState.results,s.value.length>0&&r("step-valid",!0)),((v=(d=a.wizardState)==null?void 0:d.currentJob)==null?void 0:v.status)==="COMPLETED"&&s.value.length===0&&w()}),($,d)=>(f(),_("div",os,[y(u(Q),null,{header:N(()=>d[0]||(d[0]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-chart-bar mr-2 text-primary"}),e("span",{class:"font-semibold"},"Analysis Results")],-1)])),default:N(()=>[e("div",ns,[S.value?(f(),_("div",ds,[e("div",us,[e("div",vs,[e("div",ps,[e("div",ms,[d[4]||(d[4]=e("div",{class:"text-600 font-medium mb-2"},"Total Predictions",-1)),e("div",ys,E(s.value.length),1)])]),e("div",fs,[e("div",gs,[d[5]||(d[5]=e("div",{class:"text-600 font-medium mb-2"},"Articles Analyzed",-1)),e("div",hs,E(h.value),1)])]),e("div",bs,[e("div",Ss,[d[6]||(d[6]=e("div",{class:"text-600 font-medium mb-2"},"Avg Confidence",-1)),e("div",ws,E(z.value)+"%",1)])])])]),e("div",xs,[d[7]||(d[7]=e("div",{class:"text-lg font-medium mb-3"},"Sample Predictions",-1)),(f(!0),_(ae,null,le(s.value.slice(0,3),v=>(f(),_("div",{key:v.id,class:"result-item mb-3"},[e("div",As,[e("div",_s,[e("div",Es,[e("div",$s,E(v.predictionText),1),e("div",Cs," From: "+E(v.article.title),1),e("div",Ds,[y(u(oe),{value:`${v.confidenceScore}% confidence`,severity:"info"},null,8,["value"]),y(u(oe),{value:v.rating,severity:c(v.rating)},null,8,["value","severity"])])])])])]))),128))]),e("div",Rs,[y(u(M),{label:"Start New Analysis",icon:"pi pi-refresh",onClick:b,class:"mr-2"}),y(u(M),{label:"View Full Results",icon:"pi pi-external-link",severity:"secondary",outlined:"",onClick:p})])])):(f(),_("div",cs,[d[1]||(d[1]=e("div",{class:"mb-4"},[e("i",{class:"pi pi-chart-line text-6xl text-400"})],-1)),d[2]||(d[2]=e("div",{class:"text-900 font-medium text-xl mb-2"},"Analysis Results Step",-1)),d[3]||(d[3]=e("div",{class:"text-600 mb-4"},"This component will be implemented in task 5.1",-1)),y(u(M),{label:"Generate Test Results",onClick:w})]))])]),_:1})]))}}),zs=ee(ks,[["__scopeId","data-v-9ce76a09"]]),T=class T{constructor(t={}){B(this,"options");B(this,"sessionId");this.options={maxAge:t.maxAge||T.DEFAULT_MAX_AGE,enableSessionRecovery:t.enableSessionRecovery??!0,enableCrossTabRecovery:t.enableCrossTabRecovery??!1,compressionEnabled:t.compressionEnabled??!1,encryptionEnabled:t.encryptionEnabled??!1},this.sessionId=this.generateSessionId()}generateSessionId(){return`wizard-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async saveRecoveryState(t,a,r){try{const o={currentStep:t,stepStates:a,wizardState:r,timestamp:Date.now(),version:T.CURRENT_VERSION,sessionId:this.sessionId},s=await this.serializeRecoveryData(o);this.options.enableSessionRecovery&&(localStorage.setItem(T.RECOVERY_KEY,s),sessionStorage.setItem(T.SESSION_KEY,this.sessionId)),this.options.enableCrossTabRecovery&&sessionStorage.setItem(T.RECOVERY_KEY,s)}catch(o){console.warn("Failed to save wizard recovery state:",o)}}async loadRecoveryState(){try{let t=null;if(this.options.enableSessionRecovery&&(t=localStorage.getItem(T.RECOVERY_KEY)),!t&&this.options.enableCrossTabRecovery&&(t=sessionStorage.getItem(T.RECOVERY_KEY)),!t)return null;const a=await this.deserializeRecoveryData(t);return this.isRecoveryDataValid(a)?a:(this.clearRecoveryState(),null)}catch(t){return console.warn("Failed to load wizard recovery state:",t),this.clearRecoveryState(),null}}clearRecoveryState(){try{localStorage.removeItem(T.RECOVERY_KEY),sessionStorage.removeItem(T.RECOVERY_KEY),sessionStorage.removeItem(T.SESSION_KEY)}catch(t){console.warn("Failed to clear wizard recovery state:",t)}}async isRecoveryAvailable(){return await this.loadRecoveryState()!==null}async getRecoverySummary(){const t=await this.loadRecoveryState();if(!t)return null;const r=["Article Selection","Analysis Execution","Analysis Results"][t.currentStep-1]||"Unknown Step",o=new Date(t.timestamp),s=Date.now()-t.timestamp>this.options.maxAge,S=this.calculateDataSize(t);return{stepName:r,lastSaved:o,dataSize:S,isExpired:s}}async serializeRecoveryData(t){try{const a={...t,stepStates:Array.from(t.stepStates.entries()).map(([o,s])=>{var S;return[o,{...s,lastValidated:(S=s.lastValidated)==null?void 0:S.toISOString()}]})};let r=JSON.stringify(a);return this.options.compressionEnabled&&(r=await this.compressData(r)),this.options.encryptionEnabled&&(r=await this.encryptData(r)),r}catch(a){throw new Error(`Failed to serialize recovery data: ${a}`)}}async deserializeRecoveryData(t){try{let a=t;this.options.encryptionEnabled&&(a=await this.decryptData(a)),this.options.compressionEnabled&&(a=await this.decompressData(a));const r=JSON.parse(a),o=new Map;return r.stepStates&&r.stepStates.forEach(([s,S])=>{o.set(s,{...S,lastValidated:S.lastValidated?new Date(S.lastValidated):null})}),{...r,stepStates:o}}catch(a){throw new Error(`Failed to deserialize recovery data: ${a}`)}}isRecoveryDataValid(t){return t.version!==T.CURRENT_VERSION?(console.warn(`Recovery data version mismatch: ${t.version} vs ${T.CURRENT_VERSION}`),!1):Date.now()-t.timestamp>this.options.maxAge?(console.warn("Recovery data is too old"),!1):!t.currentStep||!t.stepStates||!t.wizardState?(console.warn("Recovery data is missing required fields"),!1):t.currentStep<1||t.currentStep>3?(console.warn("Recovery data has invalid current step"),!1):!0}calculateDataSize(t){try{const a=JSON.stringify(t),r=new Blob([a]).size;return r<1024?`${r} B`:r<1024*1024?`${Math.round(r/1024)} KB`:`${Math.round(r/(1024*1024))} MB`}catch{return"Unknown"}}async compressData(t){return t}async decompressData(t){return t}async encryptData(t){return t}async decryptData(t){return t}};B(T,"CURRENT_VERSION","1.0.0"),B(T,"SESSION_KEY","wizard-session-id"),B(T,"RECOVERY_KEY","wizard-recovery-data"),B(T,"DEFAULT_MAX_AGE",24*60*60*1e3);let fe=T;class Is{constructor(t={}){B(this,"recoverySystem");this.recoverySystem=new fe(t)}async shouldOfferRecovery(){return await this.recoverySystem.isRecoveryAvailable()}async getRecoveryDialogData(){const t=await this.recoverySystem.getRecoverySummary();return{show:t!==null&&!t.isExpired,summary:t,loading:!1}}async acceptRecovery(){return await this.recoverySystem.loadRecoveryState()}async declineRecovery(){this.recoverySystem.clearRecoveryState()}async saveState(t,a,r){await this.recoverySystem.saveRecoveryState(t,a,r)}clearState(){this.recoverySystem.clearRecoveryState()}}class Vs{constructor(t,a=3e4){B(this,"recoveryManager");B(this,"autoSaveInterval",null);B(this,"isDirty",!1);B(this,"saveIntervalMs");this.recoveryManager=t,this.saveIntervalMs=a}startAutoSave(t,a,r){this.autoSaveInterval&&this.stopAutoSave(),this.autoSaveInterval=setInterval(async()=>{if(this.isDirty)try{await this.recoveryManager.saveState(t(),a(),r()),this.isDirty=!1}catch(o){console.warn("Auto-save failed:",o)}},this.saveIntervalMs)}stopAutoSave(){this.autoSaveInterval&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}markDirty(){this.isDirty=!0}async forceSave(t,a,r){await this.recoveryManager.saveState(t(),a(),r()),this.isDirty=!1}}const Ns={class:"recovery-content"},Ms={key:0,class:"text-center p-4"},Fs={key:1,class:"recovery-info"},Ts={class:"session-details surface-card p-3 border-round mb-4"},Ls={class:"grid"},Ps={class:"col-12 md:col-6"},Os={class:"detail-item mb-3"},Us={class:"detail-value font-medium"},Js={class:"col-12 md:col-6"},Gs={class:"detail-item mb-3"},Bs={class:"detail-value font-medium"},Ws={class:"col-12 md:col-6"},js={class:"detail-item"},Ys={class:"detail-value font-medium"},Ks={class:"col-12 md:col-6"},qs={class:"detail-item"},Hs={class:"detail-value"},Xs={key:0,class:"expired-warning mb-4"},Qs={class:"recovery-options"},Zs={class:"option-cards"},ea={class:"flex align-items-start"},ta={class:"flex align-items-start"},sa={class:"flex align-items-center justify-content-between w-full"},aa={class:"flex align-items-center gap-2"},la=Z({__name:"WizardRecoveryDialog",props:{visible:{type:Boolean},summary:{},loading:{type:Boolean,default:!1}},emits:["update:visible","continue-session","start-fresh"],setup(D,{emit:t}){const a=D,r=t,o=C("restore"),s=C(!1),S=L(()=>{var v;if(!((v=a.summary)!=null&&v.lastSaved))return"Unknown";const w=new Date,c=a.summary.lastSaved,b=w.getTime()-c.getTime(),p=Math.floor(b/(1e3*60)),$=Math.floor(b/(1e3*60*60)),d=Math.floor(b/(1e3*60*60*24));return p<1?"Just now":p<60?`${p} minute${p>1?"s":""} ago`:$<24?`${$} hour${$>1?"s":""} ago`:`${d} day${d>1?"s":""} ago`}),h=async()=>{s.value=!0;try{r("continue-session"),r("update:visible",!1)}catch(w){console.error("Error continuing session:",w)}finally{s.value=!1}},z=async()=>{s.value=!0;try{r("start-fresh"),r("update:visible",!1)}catch(w){console.error("Error starting fresh:",w)}finally{s.value=!1}};return H(()=>{var w;return(w=a.summary)==null?void 0:w.isExpired},w=>{w&&(o.value="fresh")}),(w,c)=>(f(),j(u(me),{visible:w.visible,"onUpdate:visible":c[4]||(c[4]=b=>w.visible=b),modal:"",closable:!1,draggable:!1,class:"wizard-recovery-dialog",style:{width:"500px"}},{header:N(()=>c[5]||(c[5]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-history mr-2 text-primary"}),e("span",{class:"font-semibold"},"Restore Previous Session")],-1)])),footer:N(()=>[e("div",sa,[c[16]||(c[16]=e("div",{class:"recovery-tip text-600 text-sm"},[e("i",{class:"pi pi-info-circle mr-1"}),ie(" Your progress is automatically saved every 30 seconds ")],-1)),e("div",aa,[y(u(M),{label:"Start Fresh",severity:"secondary",outlined:"",disabled:w.loading||s.value,onClick:z},null,8,["disabled"]),y(u(M),{label:"Continue Session",disabled:w.loading||s.value||o.value!=="restore",loading:s.value&&o.value==="restore",onClick:h},null,8,["disabled","loading"])])])]),default:N(()=>[e("div",Ns,[w.loading?(f(),_("div",Ms,[y(u(_e),{size:"50"}),c[6]||(c[6]=e("div",{class:"mt-3 text-600"},"Checking for previous session...",-1))])):w.summary?(f(),_("div",Fs,[c[15]||(c[15]=e("div",{class:"mb-4"},[e("div",{class:"text-900 font-medium mb-2"}," We found a previous analysis session that was interrupted. "),e("div",{class:"text-600"}," Would you like to continue where you left off? ")],-1)),e("div",Ts,[e("div",Ls,[e("div",Ps,[e("div",Os,[c[7]||(c[7]=e("div",{class:"detail-label text-600 text-sm"},"Last Step",-1)),e("div",Us,E(w.summary.stepName),1)])]),e("div",Js,[e("div",Gs,[c[8]||(c[8]=e("div",{class:"detail-label text-600 text-sm"},"Last Saved",-1)),e("div",Bs,E(S.value),1)])]),e("div",Ws,[e("div",js,[c[9]||(c[9]=e("div",{class:"detail-label text-600 text-sm"},"Data Size",-1)),e("div",Ys,E(w.summary.dataSize),1)])]),e("div",Ks,[e("div",qs,[c[10]||(c[10]=e("div",{class:"detail-label text-600 text-sm"},"Status",-1)),e("div",Hs,[y(u(oe),{value:w.summary.isExpired?"Expired":"Valid",severity:w.summary.isExpired?"danger":"success"},null,8,["value","severity"])])])])])]),w.summary.isExpired?(f(),_("div",Xs,[y(u(ye),{severity:"warn",closable:!1},{default:N(()=>c[11]||(c[11]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-exclamation-triangle mr-2"}),e("div",null,[e("div",{class:"font-medium"},"Session Expired"),e("div",{class:"text-sm"}," This session is older than 24 hours and may contain outdated data. ")])],-1)])),_:1,__:[11]})])):P("",!0),e("div",Qs,[c[14]||(c[14]=e("div",{class:"text-900 font-medium mb-3"},"What would you like to do?",-1)),e("div",Zs,[e("div",{class:re(["option-card p-3 border-round cursor-pointer",{"option-selected":o.value==="restore"}]),onClick:c[1]||(c[1]=b=>o.value="restore")},[e("div",ea,[y(u(we),{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=b=>o.value=b),value:"restore",class:"mr-3 mt-1"},null,8,["modelValue"]),c[12]||(c[12]=e("div",{class:"flex-1"},[e("div",{class:"font-medium text-900 mb-1"},"Continue Previous Session"),e("div",{class:"text-600 text-sm"}," Restore your progress and continue from where you left off. ")],-1))])],2),e("div",{class:re(["option-card p-3 border-round cursor-pointer mt-2",{"option-selected":o.value==="fresh"}]),onClick:c[3]||(c[3]=b=>o.value="fresh")},[e("div",ta,[y(u(we),{modelValue:o.value,"onUpdate:modelValue":c[2]||(c[2]=b=>o.value=b),value:"fresh",class:"mr-3 mt-1"},null,8,["modelValue"]),c[13]||(c[13]=e("div",{class:"flex-1"},[e("div",{class:"font-medium text-900 mb-1"},"Start Fresh"),e("div",{class:"text-600 text-sm"}," Begin a new analysis session and discard the previous one. ")],-1))])],2)])])])):P("",!0)])]),_:1},8,["visible"]))}}),ia=ee(la,[["__scopeId","data-v-abd8b9e1"]]),ra={class:"prediction-analysis-wizard"},oa={class:"flex align-items-center justify-content-between w-full"},na={class:"wizard-progress"},ca={class:"text-sm text-600"},da={class:"step-indicator"},ua={class:"steps-container"},va={class:"step-circle"},pa={key:0,class:"pi pi-check"},ma={key:1},ya={class:"step-content"},fa={class:"step-title"},ga={class:"step-description"},ha={class:"wizard-content"},ba={class:"flex align-items-center justify-content-between"},Sa={class:"flex align-items-center gap-2"},wa={class:"flex align-items-center gap-2"},xa=Z({__name:"PredictionAnalysisWizard",props:{initialStep:{default:1},autoSave:{type:Boolean,default:!0}},emits:["wizard-complete","wizard-cancelled","step-changed"],setup(D,{emit:t}){const a=D,r=t,o=Ue(),s=ge(),S=Ge(),h=C(a.initialStep),z=C(!1),w=C("slide-left"),c=C([{...pe.createArticleSelectionStep(),component:ht},{...pe.createAnalysisExecutionStep(),component:rs},{...pe.createAnalysisResultsStep(),component:zs}]),b=L(()=>c.value.map(l=>{var A,I;return{id:l.id,title:l.title,description:l.description,component:l.component,isValid:((A=p.value.get(l.id))==null?void 0:A.isValid)||!1,isComplete:((I=p.value.get(l.id))==null?void 0:I.isComplete)||!1}})),p=C(new Map),$=new Is({maxAge:24*60*60*1e3,enableSessionRecovery:!0,enableCrossTabRecovery:!1}),d=new Vs($,3e4),v=C({show:!1,summary:null,loading:!1}),U=()=>{c.value.forEach(l=>{p.value.set(l.id,{id:l.id,isValid:!1,isComplete:!1,isDirty:!1,data:{},validation:{isValid:!1,errors:[],warnings:[]},lastValidated:null})})},x=C({currentStep:h.value,totalSteps:b.value.length,canProceed:!1,canGoBack:!1,selectedArticles:[],analysisConfig:null,currentJob:null,results:[],stepData:{}}),W=L(()=>b.value.length),J=L(()=>b.value[h.value-1]),Y=L(()=>{var l;return(l=J.value)==null?void 0:l.component}),te=L(()=>{var l;return{wizardState:x.value,stepData:x.value.stepData[(l=J.value)==null?void 0:l.id]||{},isActive:!0}}),G=L(()=>h.value>1&&!z.value),O=L(()=>{const l=J.value;return(l==null?void 0:l.isValid)&&!z.value}),q=L(()=>h.value===W.value),g=L(()=>h.value===1?"Start Analysis":h.value===2?"View Results":"Next"),m=L(()=>{var l;return O.value?`Proceed to ${((l=b.value[h.value])==null?void 0:l.title)||"next step"}`:"Complete the current step to proceed"});Je("wizardContext",{state:x,updateStepData:(l,A)=>{x.value.stepData[l]={...x.value.stepData[l],...A},de()},getStepData:l=>x.value.stepData[l]||{},goToStep:l=>F(l),completeStep:l=>{const A=b.value.findIndex(I=>I.id===l);A!==-1&&(b.value[A].isComplete=!0,b.value[A].isValid=!0)}});const F=l=>{if(l<1||l>W.value)return;const A=l>h.value?"slide-left":"slide-right";w.value=A,h.value=l,x.value.currentStep=l,x.value.canGoBack=G.value,x.value.canProceed=O.value,r("step-changed",l),de()},n=()=>{G.value&&F(h.value-1)},i=async()=>{if(O.value){z.value=!0;try{const l=J.value.id;await k(l)&&(b.value[h.value-1].isComplete=!0,F(h.value+1))}catch(l){console.error("Error proceeding to next step:",l),s.add({severity:"error",summary:"Error",detail:"Failed to proceed to next step",life:5e3})}finally{z.value=!1}}},k=async l=>{const A=c.value.find(V=>V.id===l),I=p.value.get(l);if(!A||!I)return!1;try{const V=await A.validation.validate(I.data);if(I.validation=V,I.isValid=V.isValid,I.lastValidated=new Date,A.navigationGuard&&!await A.navigationGuard.canLeave(I.data))return!1;const K=at.checkStepDependencies(l,c.value.map(ue=>({id:ue.id,dependencies:ue.dependencies||[]})),p.value);return V.isValid&&K}catch(V){return console.error(`Error validating step ${l}:`,V),!1}},R=()=>{S.require({message:"Are you sure you want to cancel the analysis wizard? Any unsaved progress will be lost.",header:"Cancel Wizard",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:()=>{be(),r("wizard-cancelled"),o.push("/predictions/analysis")}})},ce=async()=>{if(O.value){z.value=!0;try{const l={selectedArticles:x.value.selectedArticles,analysisJob:x.value.currentJob,results:x.value.results,completedAt:new Date().toISOString()};r("wizard-complete",l),s.add({severity:"success",summary:"Analysis Complete",detail:"Prediction analysis wizard completed successfully",life:3e3}),be()}catch(l){console.error("Error completing wizard:",l),s.add({severity:"error",summary:"Error",detail:"Failed to complete wizard",life:5e3})}finally{z.value=!1}}},$e=l=>{var I;const A=(I=J.value)==null?void 0:I.id;if(A){const V=p.value.get(A);V&&(V.isValid=l,V.validation.isValid=l),x.value.canProceed=l}},Ce=l=>{const A=p.value.get(l);A&&(A.isComplete=!0,A.isValid=!0)},De=l=>{var I;const A=(I=J.value)==null?void 0:I.id;if(A){const V=p.value.get(A);V&&(V.data={...V.data,...l},V.isDirty=!0),x.value.stepData[A]={...x.value.stepData[A],...l},A==="article-selection"&&l.selectedArticles?x.value.selectedArticles=l.selectedArticles:A==="analysis-execution"&&l.currentJob?x.value.currentJob=l.currentJob:A==="analysis-results"&&l.results&&(x.value.results=l.results),de()}},Re=()=>{z.value=!0},ke=()=>{z.value=!1},de=async()=>{if(a.autoSave)try{await $.saveState(h.value,p.value,x.value),d.markDirty()}catch(l){console.warn("Failed to save wizard state:",l)}},ze=async()=>{if(a.autoSave)try{const l=await $.acceptRecovery();if(l)return h.value=l.currentStep||1,x.value={...x.value,...l.wizardState},p.value=l.stepStates,!0}catch(l){console.warn("Failed to load wizard state:",l)}return!1},be=()=>{$.clearState(),h.value=1,x.value={currentStep:1,totalSteps:c.value.length,canProceed:!1,canGoBack:!1,selectedArticles:[],analysisConfig:null,currentJob:null,results:[],stepData:{}},U()},Se=l=>{if(!(!l.ctrlKey&&!l.metaKey))switch(l.key.toLowerCase()){case"arrowleft":l.preventDefault(),G.value&&n();break;case"arrowright":l.preventDefault(),O.value&&i();break;case"escape":l.preventDefault(),R();break}},Ie=async()=>{try{await ze()&&s.add({severity:"success",summary:"Session Restored",detail:"Your previous analysis session has been restored",life:3e3})}catch(l){console.error("Error continuing session:",l),s.add({severity:"error",summary:"Restore Failed",detail:"Failed to restore previous session",life:5e3})}},Ve=async()=>{try{await $.declineRecovery(),U(),s.add({severity:"info",summary:"Fresh Start",detail:"Starting a new analysis session",life:3e3})}catch(l){console.error("Error starting fresh:",l)}},Ne=async()=>{try{v.value.loading=!0;const l=await $.getRecoveryDialogData();l.show&&l.summary?v.value=l:(U(),x.value.currentStep=h.value,x.value.totalSteps=W.value)}catch(l){console.error("Error checking for recovery:",l),U(),x.value.currentStep=h.value,x.value.totalSteps=W.value}finally{v.value.loading=!1}};return ne(async()=>{U(),await Ne(),d.startAutoSave(()=>h.value,()=>p.value,()=>x.value),document.addEventListener("keydown",Se)}),Ae(()=>{document.removeEventListener("keydown",Se),d.stopAutoSave(),a.autoSave&&d.forceSave(()=>h.value,()=>p.value,()=>x.value).catch(l=>{console.warn("Failed to save state on unmount:",l)})}),H(h,l=>{x.value.currentStep=l,x.value.canGoBack=G.value,x.value.canProceed=O.value}),(l,A)=>{const I=xe("tooltip");return f(),_("div",ra,[y(u(Q),{class:"wizard-header mb-4"},{header:N(()=>[e("div",oa,[A[1]||(A[1]=e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-search mr-2 text-primary"}),e("span",{class:"font-semibold text-lg"},"Prediction Analysis")],-1)),e("div",na,[e("span",ca,"Step "+E(h.value)+" of "+E(W.value),1)])])]),default:N(()=>[e("div",da,[e("div",ua,[(f(!0),_(ae,null,le(b.value,(V,K)=>(f(),_("div",{key:V.id,class:re(["step-item",{"step-active":K+1===h.value,"step-completed":K+1<h.value,"step-disabled":K+1>h.value}])},[e("div",va,[K+1<h.value?(f(),_("i",pa)):(f(),_("span",ma,E(K+1),1))]),e("div",ya,[e("div",fa,E(V.title),1),e("div",ga,E(V.description),1)]),K<b.value.length-1?(f(),_("div",{key:0,class:re(["step-connector",{"connector-completed":K+1<h.value}])},null,2)):P("",!0)],2))),128))])])]),_:1}),e("div",ha,[y(Le,{name:w.value,mode:"out-in",onBeforeEnter:Re,onAfterEnter:ke},{default:N(()=>[(f(),j(Oe(Y.value),Pe({key:h.value},te.value,{onStepValid:$e,onStepComplete:Ce,onStepData:De}),null,16))]),_:1},8,["name"])]),y(ia,{visible:v.value.show,"onUpdate:visible":A[0]||(A[0]=V=>v.value.show=V),summary:v.value.summary,loading:v.value.loading,onContinueSession:Ie,onStartFresh:Ve},null,8,["visible","summary","loading"]),y(u(Q),{class:"wizard-navigation mt-4"},{default:N(()=>[e("div",ba,[e("div",Sa,[X(y(u(M),{icon:"pi pi-arrow-left",label:"Previous",severity:"secondary",outlined:"",disabled:!G.value,onClick:n},null,8,["disabled"]),[[I,"Go to previous step",void 0,{top:!0}]])]),e("div",wa,[X(y(u(M),{icon:"pi pi-times",label:"Cancel",severity:"secondary",text:"",onClick:R},null,512),[[I,"Cancel and return to main page",void 0,{top:!0}]]),q.value?X((f(),j(u(M),{key:1,icon:"pi pi-check",label:"Complete",disabled:!O.value,loading:z.value,onClick:ce},null,8,["disabled","loading"])),[[I,"Complete the analysis process",void 0,{top:!0}]]):X((f(),j(u(M),{key:0,icon:"pi pi-arrow-right",iconPos:"right",label:g.value,disabled:!O.value,loading:z.value,onClick:i},null,8,["label","disabled","loading"])),[[I,m.value,void 0,{top:!0}]])])])]),_:1})])}}}),Aa=ee(xa,[["__scopeId","data-v-08ec53d7"]]),_a={class:"prediction-analysis-wizard-view"},Ea=Z({__name:"PredictionAnalysisWizardView",setup(D){return(t,a)=>(f(),_("div",_a,[y(Aa)]))}}),Ua=ee(Ea,[["__scopeId","data-v-3c22bb65"]]);export{Ua as default};
